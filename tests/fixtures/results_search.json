{
    "total": 84,
    "current_page": 1,
    "from": 1,
    "to": 20,
    "hits": [
        {
            "_index": "default",
            "_type": "content",
            "_id": "59",
            "_score": 2.545662,
            "_source": {
                "id": 59,
                "title": "Laravel Recipe Book published by Packt Publishing",
                "body": "One of two books I have coming out this year. Here is an intro from the book \r\n\r\n<blockquote>\r\nThe book is a blend of numerous recipes that will give you all the necessary tips you need to build an application. It starts with basic installation and configuration tasks and will get you up-and-running in no time. You will learn to create and customize your PHP app and tweak and re-design your existing apps for better performance. You will learn to implement practical recipes to utilize Laravel's modular structure, the latest method injection, route caching, and interfacing techniques to create responsive modern-day PHP apps that stand on their own against other apps. Efficient testing and deploying techniques will make you more confident with your Laravel skills as you move ahead with this book\r\n<\/blockquote>\r\n\r\n\r\n<h3>Reviews<\/h3>\r\n\r\n<a href=\"http:\/\/whatpixel.com\/best-laravel-books\/\" target=\"_blank\">Best Laravel Books From Beginner To Advanced PHP Development<\/a>\r\n\r\n<blockquote>\r\nThere\u2019s no denying the immense value of this book. If you\u2019re a beginner with some background in Laravel you can learn a lot from the Laravel 5.x Cookbook. Even if you\u2019re an advanced developer you may still learn a few things and use this book as a desk reference for common solutions.\r\n<\/blockquote>\r\n\r\n<a href=https:\/\/www.packtpub.com\/web-development\/laravel-5x-cookbook>Here is the link to Packt<\/a>",
                "type": "project",
                "created_at": 1473190538,
                "updated_at": 1479658973
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "107",
            "_score": 2.2365978,
            "_source": {
                "id": 107,
                "title": "Design Guide - Controllers, Services and IOC",
                "body": "Design Guides\r\n---\r\n\r\n  - Controllers - contains application logic and passing user input data to service\r\n  - Services - The middleware between controller and repository. Gather data from controller, performs validation and business logic, and calling repositories for data manipulation.\r\n  - Repositories - layer for interaction with models and performing DB operations\r\n  - Models - common laravel model files with relationships defined\r\n  \r\n# In and Out Burgers\r\n\r\nBetween the user's request and the response is the application. The above design guide not only gives us a consistent, flexible way to manage a requests and responses from a web user but then leads us into creating applications that can manage consul request as well.\r\n\r\n![in and out](https:\/\/docs.google.com\/drawings\/d\/1D601St_IuaZ8FKW2eXQYqE2vHqZxRRLtmB8eGpQw8Aw\/pub?w=761&h=296)\r\n\r\n\r\nStarting with the book by the Author of Laravel, Tyler Otwell\r\n\r\n[book laravel](https:\/\/leanpub.com\/laravel)\r\n\r\nThe great thing about this book is that it is not really about Laravel but about SOLID design principles\r\n\r\n  * Single responsibility principle\r\n  * Open\/closed principle\r\n  * Liskov substitution principle\r\n  * Interface segregation principle\r\n  * Dependency inversion principle\r\n\r\n[wikipedia solid](http:\/\/en.wikipedia.org\/wiki\/SOLID_(object-oriented_design)\r\n\r\n# Change to scope does not cause bad code, bad design patterns cause bad code.\r\n\r\n*Scope changes and that is fine.* This is key to the success of an application. It must change with the vision of the Product owner as deliverables bring to light what could not be seen on paper, mock ups, whiteboards etc.\r\n\r\nIf we follow the Solid Design Principles then \"change is okay\" and easy.\r\n\r\n# Back to the book \"Laravel: from Apprentice to Artisan\r\n\r\nSo Tyler Otwell goes over each principle showing them in context of Laravel.\r\n\r\nHere are some key design patters to grasp\r\n\r\n## IOC\r\n\r\nInversion of control is fundamental to a flexible application that meets the 5 goals above. By \"coding to an interface\" we can not only work faster as a team but adapt to change easily.\r\n\r\nHow to get here?\r\n\r\nOther than reading the book consider this common example. \r\n\r\n\"Build A Contract\" Taylor Otwell. Laravel: From Apprentice To Artisan (Kindle Location 75 to 185). leanpub.com. \r\n\r\nBy hooking an Interface into the Service Provider we can attach any implementation we want to that interface.\r\n\r\nThis means someone can be working on one part of the app talking to another part that is not even done yet cause they can mock out the responses based on an Interface.\r\n\r\nUsing \r\n\r\n~~~\r\nphp artisan make:provider BillingInterface\r\n~~~\r\nYou will easily setup the class to start with in the app\/Providers folder\r\n\r\nLaravel 5 is taking this to the next level with \"Contracts\/Interfaces\" as a big part of the framework.\r\n\r\n[laracasts contracts](https:\/\/laracasts.com\/series\/whats-new-in-laravel-5\/episodes\/7)\r\n\r\n\r\nThis also means we can easily swap out classes as needed. The book goes over Billing we have another example Queue. We are using Beanstalkd to work locally and Amazon SQS to work on production. This is all done via such design patters. Interfaces\/Contracts around talking to a queue.\r\n\r\n# Controllers\r\n\r\nA request comes in and it sends it to the right service. Finally it delivers the response. Below is an example of what a method in a controller should have and no more.\r\n\r\n~~~\r\napp\/Http\/Controllers\/ProjectsController.php:31\r\n    public function index()\r\n    {\r\n        try\r\n        {\r\n            $results = $this->service->getAllProjectsForThisUser();\r\n            return Response::json($this->responseServices->respond($results, \"Loaded Projects\"), 200);\r\n        }\r\n        catch(\\Exception $e) {\r\n            return Response::json($this->responseServices->respond($e->getMessage(), \"Error Getting Project Failed\"), 422);\r\n        }\r\n\r\n    }\r\n~~~\r\n\r\nIt traps any errors and responds as needed to that error.\r\n\r\n## Issues with above?\r\n\r\nYes! Error codes should come from the Service as well. How does the controller know a 422? \r\n\r\n### Service then does what?\r\n\r\nAs defined above \r\n\r\n\"The middleware between controller and repository. Gather data from controller, performs validation and business logic, and calling repositories for data manipulation.\"\r\n\r\n  * Validation\r\n  * Business Logic\r\n  * Calling Repositories\r\n  * Transform Data in and out \r\n  * Lastly returns the results with a know error code.\r\n  \r\nSince 422 is an HTTP Response \r\n\r\n~~~\r\nvendor\/symfony\/http-foundation\/Symfony\/Component\/HttpFoundation\/Response.php:64\r\n~~~\r\n\r\nWe should have possible a response transformer class to consider the non HTTP response. Then let the Controller pick from that to find its related HTTP response. See the [Build API's You Wont't Hate](https:\/\/leanpub.com\/build-apis-you-wont-hate) for more on that. Covered in the other guide shortly too.\r\n\r\n",
                "type": "post",
                "created_at": 1411380890,
                "updated_at": 1411380970
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "86",
            "_score": 2.129662,
            "_source": {
                "id": 86,
                "title": "Simple Laravel CMS Example",
                "body": "## Quick intro to Laravel using a custom CMS app I made\r\n\r\nThe repo is [here](https:\/\/github.com\/alnutile\/l4cms)\r\n \r\n![intro](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/intro_image.png?_subject_uid=54803135&w=AADdI8YLw5iRjK91_3LjSHq7b7z0ibM8KY4P7MicRH9UFA)\r\n\r\nThis is mainly to show an example of a small CMS being built in Laravel. CMS (Content Management System) that is at it's most basic level, Authentication, Simple Content Types etc.\r\n\r\nWhat we will cover.\r\n\r\n  * Installing the \"CMS\" and what Page Types it comes with\r\n  * Looking at the folder layout \"Where is....\"\r\n  * App config setting up the site\r\n  * PHP Artisan command to migrate the site\r\n  * Routes\r\n  * Page example looking at the wysiwyg, Controller, View etc\r\n  * Tags - lets add a many to many relationship\r\n  \r\n\r\nThis is NOT the end all setup just an example. There are links below to quality videos, blogs posts docs etc to take you to the next level, not only in Laravel but just Object Oriented Design and good Architecture in general.\r\n\r\nNote the theme has it's own license and you need to purchase it [here](https:\/\/wrapbootstrap.com\/theme\/colorfrog-WB01PG0H4) in order to use it.\r\n\r\n## Install the \"CMS\" and what Page Types it comes with\r\n\r\nThe repo is here https:\/\/github.com\/alnutile\/cms\r\n\r\nIn time I will add more features but it really is an app that was made for a client that the base of it I wanted to fork off for later use.\r\n\r\nRun the basic laravel install steps noted on their site http:\/\/laravel.com\/docs\/quick\r\n\r\n## What Page Types\r\n\r\n * Pages are the main landing pages for most of the site with a slug to manage the url [1]. More on Pages shortly.\r\n * Portfolios was how this project started. Basically you make One and then make projects that reference it. \r\n * Projects are just that. They fit in a Portfolio\r\n * Menu Sorting there is an admin area for menu sorting as well. Right now it is just for the top left menu. (not the black top nav)\r\n \r\nAll these \"Admin\" links can be seen below\r\n\r\n![admin_bar](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/admin_link.png?_subject_uid=54803135&w=AAAXvu_aZZUUGLFbgByRli-WjFgDpVmUDnQxverzi5_ISg)\r\n\r\n\r\n### Every landing page is a Page \r\n\r\nEvery URLs is Page, Project or Portfolio so the editor can always edit the description of the page even if there is a \"collection\" under it. For example \/all_projects is a Page that just happens to also show a collection of \"Projects\" under it. Ideally this will be a less hard coded relationship BUT this particular example just needed a simple data set.\r\n\r\n\r\nThere are Portfolio and Project pages as well that the edit can edit the description on etc.\r\n\r\n\r\n## Looking at the folder layout\r\n\r\nThis is a standard Laravel App. The one key folder is **app\/CMS** for some items. But otherwise the Controllers, Models etc have all the needed data. [2]\r\n\r\nIn app\/CMS there is the Menu Facade, and the MenuService to make managing the menu system easier. [3]\r\n\r\nThe system puts it's uploaded files under public\/img in settings, banners etc\r\n\r\n## App config setting up the site\r\n\r\nThe app default to sqlite and the bootstrap\/start.php will default to local without you needing to set anything.\r\n\r\nRunning migrations will get you a good sample set of data. You can always turn this off in app\/database\/seeds\r\n\r\nIn the app\/database\/seeds\/UsersTableSeeder.php file is the admin and test user emails and passwords to login.\r\n\r\n## Routes\r\n\r\nThe app\/routes.php is where you can manage routes and see what is there right now. \r\n\r\n## Page Example\r\n\r\nYou can edit a page or add a page.\r\n\r\nOnce in there you will see this\r\n\r\n![image_page_edit](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/edit.png?_subject_uid=54803135&w=AADonXAFhGpiKY5JL9u6d248TPQKJMPCDcHTwUi2s2Hk5Q)\r\n\r\n\r\n\r\nYou can give the page a title, SEO title, upload images and files via the wysiwyg and set the slug (Published coming soon so there can be a workflow)\r\n\r\n## Tags\r\n\r\nThere is a tagging feature that does not yet have the UI setup. (coming soon). The resource is setup but needs to be placed in the view\r\n\r\nIn php artisan tinker we can mess around with tags thought\r\n\r\n~~~\r\n\r\nphp artisan tinker\r\n$tag = new Tag(['name' => \"Test 4\"]);\r\nPortfolio::find(1)->tags()->save($tag);\r\nPortfolio::find(1)->tags->toArray();\r\nTag::find(1)->portfolios->toArray();\r\nPortfolio::find(1)->tags()->detach(1);\r\nPortfolio::find(1)->tags()->attach(1);\r\n~~~\r\n\r\nSo we are making a tag, saving it to Portfolio 1. Seeing it attached to Portfolio 1 and Seeing Portfolios attached to it.\r\n\r\n## Links\r\n\r\n * Great videos on Laravel, Oop and design patters https:\/\/laracasts.com\/\r\n * Laravel own docs are great http:\/\/laravel.com\/docs\r\n * Forums and Chat room http:\/\/laravel.io\/forum\r\n * Great overview of Laravel app building http:\/\/culttt.com\/2013\/04\/29\/getting-started-with-laravel-4\/\r\n \r\n\r\n## Footnotes\r\n\r\n  * [1] This will be refactored shortly\r\n  * [2] This will be moved shortly to make it way more extendable but leaving the core easy to manage.\r\n  * [3] Refactor this out so menu is a manyToMany relationship with the models that will use it.\r\n",
                "type": "post",
                "created_at": 1401749386,
                "updated_at": 1401749421
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "163",
            "_score": 2.1186712,
            "_source": {
                "id": 163,
                "title": "Spark Setup Issue",
                "body": "During the install [https:\/\/github.com\/laravel\/spark](https:\/\/github.com\/laravel\/spark) I kept getting this error\r\n\r\n~~~\r\n Problem 1\r\n    - Installation request for laravel\/spark-installer ~1.0 -> satisfiable by laravel\/spark-installer[v1.0.0].\r\n    - Conclusion: remove illuminate\/support v4.2.17\r\n    - laravel\/spark-installer v1.0.0 requires illuminate\/support ~5.0 -> satisfiable by illuminate\/support[v5.0.0, v5.0.22, v5.0.25, v5.0.26, v5.0.28, v5.0.33, v5.0.4, v5.1.1, v5.1.13, v5.1.16, v5.1.2, v5.1.6, v5.1.8].\r\n    - Can only install one of: illuminate\/support[v5.0.0, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.22, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.25, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.26, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.28, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.33, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.4, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.1, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.13, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.16, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.2, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.6, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.8, v4.2.17].\r\n    - Installation request for illuminate\/support == 4.2.17.0 -> satisfiable by illuminate\/support[v4.2.17].\r\n~~~\r\n\r\nFinally I went into my ~\/.composer folder. Removed `composer.lock` then I edited the `composer.json` to look like this\r\n\r\n~~~\r\n{\r\n    \"require\": {\r\n        \"laravel\/envoy\": \"~1.0\",\r\n        \"laravel\/installer\": \"~1.1\",\r\n        \"laravel\/spark-installer\": \"~1.0\"\r\n    }\r\n}\r\n~~~\r\n\r\nI use Envoy for a lot of my projects so I left that there and made sure to update my installer.\r\n\r\nThen I ran, in that folder composer update.\r\n\r\nFinally I made sure to add the path to my ~\/.bash_profile as \r\n\r\n~~~\r\nexport PATH=$PATH:\/Users\/alfrednutile\/.composer\/vendor\/bin\/\r\n~~~\r\n\r\nThen ran `source ~\/.bash_profile` \r\n\r\nWith all that in place I could go to my new Laravel install to run `spark install`",
                "type": "post",
                "created_at": 1442321916,
                "updated_at": 1442321916
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "181",
            "_score": 2.1127203,
            "_source": {
                "id": 181,
                "title": "Getting Going Quickly Windows, Behat and Selenium",
                "body": "Quick Install Steps\r\n\r\n## Vagrant and Homestead \r\n\r\nThis was easy I just followed these steps [here](http:\/\/sherriflemings.blogspot.ca\/2015\/03\/laravel-homestead-on-windows-8.html) and I was done. For me I used Vmware but Virtualbox is fine.\r\n\r\n## Windows in Selenium\r\n\r\nTwo easy steps\r\n\r\n### Step 1 Install Node.js SUPER EASY\r\n\r\n[https:\/\/nodejs.org\/en\/download\/](https:\/\/nodejs.org\/en\/download\/)\r\n\r\nInstall the .exe, restart your console and you have node!\r\n\r\n### Step 2 Install Selenium\r\n\r\nJust go here and you are done!\r\n[https:\/\/www.npmjs.com\/package\/selenium-standalone](https:\/\/www.npmjs.com\/package\/selenium-standalone)\r\n\r\nAfter those steps I run it in a powershell and the server is running and I am set to use it.\r\n\r\n## Final Touches\r\n\r\nIn my VM I \"sudo vim \/etc\/hosts\" and point it to my selenium on windows using the domain \"selenium.dev\"\r\n\r\n~~~\r\n192.168.7.57    selenium.dev\r\n~~~\r\n\r\nThen my behat.yml looks like this\r\n\r\nSo when I run this inside the VM it knows to talk to the exteral version of Selenium \r\n\r\n~~~\r\ndefault:\r\n    suites:\r\n        home_ui:\r\n            paths: [ %paths.base%\/features\/home]\r\n            contexts: [ HomePageUiContext ]\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            env_path: .env.behat\r\n        Behat\\MinkExtension:\r\n            default_session: laravel\r\n            base_url: https:\/\/recipes.dev\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/selenium.dev:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n~~~\r\n\r\nYou can see more of it [here](https:\/\/github.com\/alnutile\/recipes\/blob\/master\/behat.yml)\r\n\r\n ",
                "type": "post",
                "created_at": 1462296071,
                "updated_at": 1473357085
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "76",
            "_score": 2.0853817,
            "_source": {
                "id": 76,
                "title": "Using Dot Env files to manage settings",
                "body": "Wow. Included in Laravel http:\/\/laravel.com\/docs\/configuration#protecting-sensitive-configuration\r\n\r\n1. removed due to old news\r\n\r\n2. [http:\/\/mattstauffer.co\/blog\/laravel-forge-using-environment-variables-for-environment-detection\/](http:\/\/mattstauffer.co\/blog\/laravel-forge-using-environment-variables-for-environment-detection\/)\r\n\r\n## Update\r\nI really like the second link and how it sets up a .env file first to just return a simple string. After that you can have the .env.production.php or .env.local.php that laravel can look for.\r\n\r\n~~~\r\n\/\/bootstrap\/start.php\r\n$env = $app->detectEnvironment(function()\r\n{\r\n    if (file_exists(__DIR__ . '\/..\/.env')) {\r\n        return include(__DIR__ . '\/..\/.env');\r\n    } else {\r\n        return 'production';\r\n    }\r\n});\r\n~~~\r\n\r\nQuite simple at that point to separate all of the environments.",
                "type": "post",
                "created_at": 1400410748,
                "updated_at": 1402143902
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "236",
            "_score": 2.018045,
            "_source": {
                "id": 236,
                "title": "Passing from Blade to VueJs",
                "body": "A lot of posts had [this](https:\/\/medium.com\/@m_ramsden\/passing-data-from-laravel-to-vue-98b9d2a4bd23) style.\r\n\r\nI ended up just needing this:\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/huucm3vx4uyklq7\/Screenshot%202018-02-23%2020.29.22.png?dl=0)\r\n\r\nThe controller simply does this:\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/qw7x7u7ayr7j441\/Screenshot%202018-02-23%2020.29.52.png?dl=0)",
                "type": "post",
                "created_at": 1519442724,
                "updated_at": 1519443006
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "109",
            "_score": 1.9809898,
            "_source": {
                "id": 109,
                "title": "Temporary Auth Updates L5",
                "body": "# Auth updates\r\n\r\nFirst make sure your composer update has the latest Laravel and check that\r\nthere are not relevant fixes already via laravel\/docs master laravel\/framework master or laravel\/laravel dev\r\n\r\nMoved evn files to the new format and only 1 is needed now having the\r\n\r\n~~~\r\nAPP_ENV='local' \r\n~~~\r\n\r\nsetting for the environment.\r\n\r\n\r\nThen update the path in the AuthController to go to auth\/login\r\n~~~\r\n#app\/Http\/Controllers\/Auth\/AuthController\r\n\r\n    public function login(LoginRequest $request)\r\n    {\r\n        if ($this->auth->attempt($request->only('email', 'password')))\r\n        {\r\n            return redirect('\/');\r\n        }\r\n\r\n        return redirect('\/auth\/login')->withErrors([\r\n            'email' => 'The credentials you entered did not match our records. Try again?',\r\n        ]);\r\n    }\r\n~~~\r\n\r\nHere is a good article on using annotations which are needed now in the controller.\r\n\r\n[http:\/\/mattstauffer.co\/blog\/laravel-5.0-route-annotations](http:\/\/mattstauffer.co\/blog\/laravel-5.0-route-annotations)\r\n\r\nFor example I remove api\/v1\/projects from routes.php (which is key it can not be in both)\r\n\r\nThen in the ProjectsController.php I added this to the top of the class\r\n\r\n~~~\r\n\/**\r\n * @Middleware(\"BehatEditor\\Http\\Middleware\\AuthMiddleware\")\r\n * @Before(\"auth\")\r\n *\/\r\nclass ProjectsController extends BaseController {\r\n~~~\r\n\r\n\r\nand in the index function\r\n\r\n~~~\r\n\r\n    \/**\r\n     * @Get(\"api\/v1\/projects\", as=\"api.v1.projects\")\r\n     * @return mixed\r\n     *\/\r\n    public function index()\r\n    {\r\n        try\r\n        {\r\n            $results = $this->service->getAllProjectsForThisUser();\r\n            \/**\r\n             * @TODO move Response to a class to not have it tightly coupled here\r\n             *\/\r\n            return Response::json($this->responseServices->respond($results, \"Loaded Projects\"), 200);\r\n        }\r\n        catch(\\Exception $e) {\r\n            return Response::json($this->responseServices->respond($e->getMessage(), \"Error Getting Project Failed\"), 422);\r\n        }\r\n\r\n    }\r\n~~~\r\n\r\nSo the route is now api\/v1\/projects using Get and the route name for ease of use is api.v1.projects\r\n\r\nThen I ran\r\n\r\n~~~\r\nphp artisan route:scan \r\n~~~\r\n\r\nto get this file made for me\r\n\r\n~~~\r\nstorage\/framework\/routes.scanned.php\r\n~~~\r\n\r\nInside we see\r\n\r\n~~~\r\n<?php \r\n\r\n$router->get('auth\/login', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@showLoginForm', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->post('auth\/login', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@login', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->get('auth\/logout', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@logout', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->get('api\/v1\/sites\/reports', ['uses' => 'App\\Http\\Controllers\\DashController@getDash', 'domain' => NULL, 'as' => 'sites.reports', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n$router->get('api\/v1\/projects', ['uses' => 'App\\Http\\Controllers\\ProjectsController@index', 'domain' => NULL, 'as' => 'api.v1.projects', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n$router->get('sites', ['uses' => 'App\\Http\\Controllers\\SitesController@index', 'domain' => NULL, 'as' => 'sites.index', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n\r\n~~~\r\n\r\nAll the App namespaces can really be your App or the default Laravel app files.\r\n\r\nThis file is auto generated from that command so do not edit it.\r\n\r\nThe one we just made is\r\n\r\n~~~\r\n$router->get('api\/v1\/projects', ['uses' => 'App\\Http\\Controllers\\ProjectsController@index', 'domain' => NULL, 'as' => 'api.v1.projects', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n~~~",
                "type": "post",
                "created_at": 1413123628,
                "updated_at": 1413124846
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "168",
            "_score": 1.9800335,
            "_source": {
                "id": 168,
                "title": "Logout User After Inactivity Laravel and Milddleware",
                "body": "**Original Post** [http:\/\/laravel-tricks.com\/tricks\/session-timeout-for-logged-in-user](http:\/\/laravel-tricks.com\/tricks\/session-timeout-for-logged-in-user)\r\n\r\nThis Middleware made it super easy to satisfy a requirement to log the user out after 15 minutes of in activity.\r\n\r\nI added only a few touchups.\r\n\r\nOne was the `getTimeOut` this was so I can work locally and override this by setting it to a large number.  I could even use it to just bypass the whole things for a bit since on `local` I rather not deal with this. \r\n\r\nAlso I removed the message count since it just was not needed for what I was doing.\r\n\r\n\r\n~~~\r\n<?php namespace App\\Http\\Middleware;\r\nuse Closure;\r\nuse Illuminate\\Support\\Facades\\Auth;\r\nuse Illuminate\\Session\\Store;\r\nclass SessionTimeout {\r\n    protected $session;\r\n    protected $timeout=900;\r\n    public function __construct(Store $session){\r\n        $this->session=$session;\r\n    }\r\n    \/**\r\n     * Handle an incoming request.\r\n     *\r\n     * @param  \\Illuminate\\Http\\Request  $request\r\n     * @param  \\Closure  $next\r\n     * @return mixed\r\n     *\/\r\n    public function handle($request, Closure $next)\r\n    {\r\n        if(!$this->session->has('lastActivityTime'))\r\n            $this->session->put('lastActivityTime',time());\r\n        elseif(time() - $this->session->get('lastActivityTime') > $this->getTimeOut()){\r\n            $this->session->forget('lastActivityTime');\r\n            Auth::logout();\r\n            return redirect('auth\/login')->withErrors(['You had not activity in 15 minutes']);\r\n        }\r\n        $this->session->put('lastActivityTime',time());\r\n        return $next($request);\r\n    }\r\n\r\n    protected function getTimeOut()\r\n    {\r\n        return (env('TIMEOUT')) ?: $this->timeout;\r\n    }\r\n}\r\n~~~",
                "type": "post",
                "created_at": 1447485550,
                "updated_at": 1447485569
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "124",
            "_score": 1.965077,
            "_source": {
                "id": 124,
                "title": "Laravel Blade and Angular brackets",
                "body": "I use one AngularController.php to render main.blade.php file that then renders angular. The only other blade file is the login page.\r\nI could have done this in the routes.php file but since the routes file has the login page I decided to place it in this controller.\r\n\r\n\r\n~~~\r\n<?php namespace App\\Http\\Controllers;\r\n\r\n\r\nuse Illuminate\\Support\\Facades\\Blade;\r\nuse Illuminate\\Support\\Facades\\Config;\r\nuse Illuminate\\Support\\Facades\\View;\r\nuse Laracasts\\Utilities\\JavaScript\\Facades\\JavaScript;\r\n\r\n\r\n\/**\r\n * @Middleware(\"auth\")\r\n *\/\r\nclass AngularController extends BaseController {\r\n\r\n    use UserHelper;\r\n\r\n    \/**\r\n     * @var UserService\r\n     *\/\r\n    private $userService;\r\n\r\n    public function __construct(UserService $userService)\r\n    {\r\n        $this->userService = $userService;\r\n    }\r\n\r\n    \/**\r\n     * @Get(\"behat\", as=\"behat.dash\")\r\n     *\/\r\n\tpublic function index()\r\n\t{\r\n\r\n        Blade::setContentTags('<%', '%>'); \t\t\/\/ for variables and all things Blade\r\n        Blade::setEscapedContentTags('<%%', '%%>'); \t\/\/ for escaped data\r\n        $user_id = $this->getUserId();\r\n        $profile = $this->userService->getPerson($user_id);\r\n        $token = csrf_token();\r\n        $chat_on = Config::get('app.chat_on', true);\r\n        JavaScript::put(\r\n            [\r\n                'pusher_public_key' => $_ENV['PUSHER_PUBLIC'],\r\n                'sauce_key' => $_ENV['SAUCE_TOKEN'],\r\n                'sauce_user' => $_ENV['SAUCE_USER'],\r\n                'profile' => $profile,\r\n                'token' => $token,\r\n                'debug' => Config::get('app.debug'),\r\n            ]\r\n        );\r\n\t\treturn View::make('layouts.main', compact('chat_on'));\r\n\t}\r\n\r\n}\r\n~~~\r\n\r\nThanks to [http:\/\/scotch.io\/bar-talk\/quick-tip-using-laravel-blade-with-angularjs](http:\/\/scotch.io\/bar-talk\/quick-tip-using-laravel-blade-with-angularjs) for the tip",
                "type": "post",
                "created_at": 1418995150,
                "updated_at": 1418995150
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "151",
            "_score": 1.9487176,
            "_source": {
                "id": 151,
                "title": "Laravel 5.1 Behat and Codeship",
                "body": "The new integration testing features with Laravel 5.1 make Behat almost not needed BUT we do a lot of AngularJs work and instead of using karma to test the ui we enjoy using behat since we like the Gherkin Syntax and how we can easily code custom steps in PHP.\r\n\r\nHere are some steps to getting behat going on Codeship so you get full CI even of Angular.\r\n\r\nThis is all based off of [https:\/\/github.com\/laracasts\/Behat-Laravel-Extension](https:\/\/github.com\/laracasts\/Behat-Laravel-Extension)\r\n\r\n\r\n## Behat.yml\r\n\r\nbehat.yml looks like this for me\r\n\r\n~~~\r\ndefault:\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            # env_path: .env.behat\r\n        Behat\\MinkExtension:\r\n            base_url: https:\/\/microservicehub.dev:44300\r\n            default_session: laravel\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/192.168.10.1:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n\r\ncodeship:\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            env_path: .env.codeship\r\n        Behat\\MinkExtension:\r\n            base_url: http:\/\/localhost:8080\r\n            default_session: laravel\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/localhost:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n~~~\r\n\r\nThis is so I can run it locally as needed. The Codeship profile will then call in the `.env.codeship` and update the url as needed.\r\n\r\n## .env.codeship\r\n\r\nThis file has \r\n\r\n~~~\r\nAPP_ENV=testing\r\nAPP_DEBUG=true\r\nAPP_KEY=f5edkkfijPDKQXPLHyYNDhiNZZrpT0Qd\r\n\r\nDB_HOST=localhost\r\nDB_DATABASE=test\r\n\r\nCACHE_DRIVER=file\r\nSESSION_DRIVER=file\r\nQUEUE_DRIVER=sync\r\n\r\nMAIL_DRIVER=smtp\r\nMAIL_HOST=mailtrap.io\r\nMAIL_PORT=2525\r\nMAIL_USERNAME=null\r\nMAIL_PASSWORD=null\r\nMAIL_ENCRYPTION=null\r\n~~~\r\n\r\n## Build Script for Codeship\r\n\r\nUsing the code they offer on their site I add that to my projects folder under tests\/selenium_server.sh it is this file [here](https:\/\/github.com\/codeship\/scripts\/blob\/master\/packages\/selenium_server.sh)\r\n\r\nMaybe some do not need to be there?\r\n\r\n## Codeship Test Settings\r\n\r\nNow in the settings I end up with inside the CodeShip UI are as follows\r\n\r\nHere for example is the URL for my project to find these settings.\r\n\r\n`https:\/\/codeship.com\/projects\/8844\/configure_tests`\r\n\r\nUnder Setup Commands\r\n\r\n~~~\r\n# Set php version through phpenv. 5.3, 5.4 and 5.5 available\r\nphpenv local 5.5\r\n# Install dependencies through Composer\r\ncomposer config -g github-oauth.github.com foobar\r\ntouch .env\r\necho \"APP_ENV='testing'\" >> .env\r\necho \"DB_DATABASE='test'\" >> .env\r\necho \"MYSQL_TESTING_URL='localhost'\" >> .env\r\necho \"APP_KEY=DHMbPIbNLd1jI0ZEZZSxRFOHj03SU4P5\" >> .env\r\necho \"CACHE_DRIVER=file\" >> .env\r\necho \"SESSION_DRIVER=file\" >> .env\r\necho \"QUEUE_DRIVER=sync\" >> .env\r\necho \"MAIL_DRIVER=smtp\" >> .env\r\necho \"MAIL_HOST=smtp.mailgun.org\" >> .env\r\necho \"MAIL_PORT=2525\" >> .env\r\ncomposer install --dev\r\nphp artisan migrate\r\nphp artisan db:seed\r\nnohup bash -c \"sh tests\/selenium_server.sh &\" && sleep 9\r\ncd public && nohup bash -c \"php -S localhost:8080 &\" && sleep 9\r\ncd ..\/\r\n~~~\r\n\r\nUnder Configure Test\r\n\r\n~~~\r\nDB_DATABASE=test phpunit\r\nphp artisan migrate\r\nphp artisan db:seed\r\nvendor\/bin\/behat --profile=codeship --stop-on-failure\r\n~~~\r\n\r\nI run the migration one more time to get it ready for behat\r\n\r\n![behat](https:\/\/dl.dropboxusercontent.com\/s\/2uadht5426s40p8\/behat_codeship.png?dl=0)\r\n",
                "type": "post",
                "created_at": 1436020685,
                "updated_at": 1481767405
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "49",
            "_score": 1.9402648,
            "_source": {
                "id": 49,
                "title": "Angular, Laravel CMS",
                "body": "Working on a full Saas solution for a client with Laravel, Angular and behat to make sure it stays working.\r\n\r\n<iframe width=\"640\" height=\"480\" src=\"https:\/\/www.youtube.com\/embed\/on9GAAIus_M\" frameborder=\"0\" allowfullscreen><\/iframe>",
                "type": "project",
                "created_at": 1398822938,
                "updated_at": 1454248086
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "133",
            "_score": 1.9238532,
            "_source": {
                "id": 133,
                "title": "Dealing with Oauth2 Server and Laravel for both a local app login and for remote apps using Lucadegasperi\/oauth2-server-laravel",
                "body": "This is all based around this library [https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel)\r\n\r\nI am building and API to be used by an iOs and Android client I will be making soon. **But** I also needed the filter system to deal with my local Laravel view that was using the api via an Angular driven widget so the user can go to the website as well.\r\n\r\nSo the website is where the user can go to do change settings, subscription updates etc, but in that case they are logged in via the Laravel login form. From there they land on the profile page where the Angular widget will do n xhr request to the api to fill in the table\/settings.\r\n\r\nThe routes ends up looking like this \r\n\r\n~~~\r\n\r\nRoute::filter('setUser', function()\r\n{\r\n\tif(Auth::guest())\r\n\t{\r\n\t\t$user_id = Authorizer::getResourceOwnerId();\r\n\t\tAuth::loginUsingId($user_id);\r\n\t}\r\n});\r\n\r\n\/\/The view they see using Laravel Blade and an embedded angular widget\r\nRoute::get('profile', ['middleware' => 'auth', 'uses' => 'ProfileController@getProfile']);\r\n\r\n\/\/The API\r\nRoute::group(['prefix' => 'api\/v1', 'before' => 'oauth|setUser|auth'], function() {\r\n\tRoute::get('profile',  'ProfileController@getApiProfile');\r\n});\r\n~~~\r\n\r\nThe thing is the Oauth2 filter was causing some issues\r\n\r\n  1 Looks for a access_token query string or header\r\n  2 Does not load the user like I need\r\n\r\n\r\nThe first issue I just made a class to extend the core filter for the Oauth2 library.\r\n\r\n###  My provider \r\n\r\n~~~\r\n<?php namespace App\\Providers;\r\n\r\nuse App\\Filters\\OauthTotalRecalls;\r\nuse Illuminate\\Support\\ServiceProvider;\r\nclass OauthFilterProvider extends ServiceProvider {\r\n    public function boot()\r\n    {\r\n        $this->app->bindShared('LucaDegasperi\\OAuth2Server\\Filters\\OAuthFilter', function ($app) {\r\n            $httpHeadersOnly = $app['config']->get('oauth2.http_headers_only');\r\n            return new OauthTotalRecalls($app['oauth2-server.authorizer'], $httpHeadersOnly);\r\n        });\r\n    }\r\n    \/**\r\n     * Register the service provider.\r\n     *\r\n     * @return void\r\n     *\/\r\n    public function register()\r\n    {\r\n        \/\/ TODO: Implement register() method.\r\n    }\r\n}\r\n~~~\r\n\r\nThen I register that in my app.conf after I register his.\r\n\r\n### My Filter\r\n\r\nIt overrides the filter to do one thing and that is to check if the user is a guest. Which they would not be if they are logging in via the Laravel login form.\r\n\r\n~~~\r\n<?php namespace App\\Filters;\r\nuse Illuminate\\Support\\Facades\\Auth;\r\nuse LucaDegasperi\\OAuth2Server\\Filters\\OAuthFilter;\r\nclass OauthTotalRecalls extends OAuthFilter {\r\n    \/**\r\n     * Run the oauth filter\r\n     *\r\n     * @internal param mixed $route, mixed $request, mixed $scope,...\r\n     * @return void a bad response in case the request is invalid\r\n     *\/\r\n    public function filter()\r\n    {\r\n        if(Auth::guest())\r\n        {\r\n            if (func_num_args() > 2) {\r\n                $args = func_get_args();\r\n                $this->scopes = array_slice($args, 2);\r\n            }\r\n            $this->authorizer->validateAccessToken($this->httpHeadersOnly);\r\n            $this->validateScopes();\r\n        }\r\n    }\r\n}\r\n~~~\r\n\r\n### Loading user\r\n\r\nSo at this point the user is logged in via Laravel so the Auth::user() is fully set. But lastly if this was the token based log in the \"setUser\" filter will kick in and load the user from the token. If the token is wrong then this all will fail.\r\n\r\n~~~\r\nRoute::filter('setUser', function()\r\n{\r\n\tif(Auth::guest())\r\n\t{\r\n\t\t$user_id = Authorizer::getResourceOwnerId();\r\n\t\tAuth::loginUsingId($user_id);\r\n\t}\r\n});\r\n~~~\r\n",
                "type": "post",
                "created_at": 1424707047,
                "updated_at": 1424707307
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "95",
            "_score": 1.9145033,
            "_source": {
                "id": 95,
                "title": "Many to Many Polymorphic Relations from Laravel to Angular and back",
                "body": "This will cover having a polymorphic relationship in Laravel, showing it on a form in Angular and saving it back to Laravel. Overall it is well documented [here](http:\/\/laravel.com\/docs\/eloquent#many-to-many-polymorphic-relations) at the great docs at Laravel but this post might help in a few areas.\r\n\r\nAs someone defines Polymorphic Relationships there\r\n\r\n>\"Polymorphic relations allow a model to belong to more than one other model, on a single association. For example, you might have a photo model that belongs to either a staff model or an order model. \"\r\n\r\n## Output the data to Angular\r\n\r\nTaking the User Model as an example I query the user but then before returning the data to Angular I append the polymorphic results. In this case we will call it Specialties\r\n~~~\r\nprotected function transformOutgoingData($data)\r\n    {\r\n        $data->specialties = $data->specialties()->getResults()->lists('id');\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nThis returns just an array to Angular to deal with. When sending it an Object trouble getting Angular to set the selected options. The hard part, since by default it just worked, was to send not only the 2 selected Specialties but the 20 other possible ones and make the list out of that.\r\n\r\n~~~\r\n#angular html file\r\n<div class=\"form-group\" ng-if=\"userHasAdminRole(user)\"  markdown=\"1\">\r\n        <label>Specialties:<\/label>\r\n        <select ng-options=\"specialty.id as specialty.name for specialty in user.specialties_all\"\r\n                name=\"specialty\"\r\n                multiple\r\n                ng-model=\"user.specialties\"\r\n                ng-required=\"true\"\r\n                class=\"form-control\">\r\n        <\/select>\r\n    <\/div>\r\n~~~\r\n\r\nThe specialties_all comes from the method I run on the data before output it which I do anyways on many data models. This comes right before the transformOutgoingData.\r\n\r\n~~~\r\n    protected function addDataToOutGoingModel($user)\r\n    {\r\n        $user = $this->addAllSpecialtiesToModel($user);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nThis way all my select lists on that page and other data lists, checkboxes etc have the data they need.\r\n\r\nFinally when the person clicks Submit it is sent back to Laravel. So far I could not just save or update the user with this info. For example\r\n\r\n~~~\r\n#app\/models\/User.php\r\n    public function update($user_id, $all)\r\n    {\r\n        $all = $this->transformIncomingData($all);\r\n        try {\r\n            $user = \\User::findOrFail($user_id);\r\n        }\r\n        catch(\\Expection $e){\r\n            throw new \\Exception(\"User not found\");\r\n        }\r\n\r\n        $user->update($all);\r\n        $user = $this->saveDataToModel($user);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nThe  $user->update($all); will crash with this extra \"specialties\" data coming in with this error.\r\n\r\n>\"preg_replace(): Parameter mismatch, pattern is a string while replacement is an array\"\r\n\r\nSo instead I do a step before and after\r\n\r\nBefore I run transformIncomingData and unset the $all['specialties'] key I get from Input::all() and save that to a property\r\n\r\n~~~\r\n    protected function transformIncomingData($data)\r\n    {\r\n        $data = ( isset($data['specialties'])) ? $this->transformSpecialtiesIncoming($data) : $data;\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nwhich goes to\r\n\r\n~~~\r\n    protected function transformSpecialtiesIncoming($data)\r\n    {\r\n        $this->original_specialities = $data['specialties'];\r\n        unset($data['specialties']);\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nThen after I update the User I run saveDataToModel($user) which triggers this method\r\n\r\n~~~\r\n    protected function setSpecialties($user)\r\n    {\r\n        $user->specialties()->sync($this->original_specialities);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nFinally back to Angular with the results. \r\n\r\nAnother good way to tie all this together is the Model Observer Pattern noted here [http:\/\/laravel.com\/docs\/eloquent#model-observers](http:\/\/laravel.com\/docs\/eloquent#model-observers)\r\n\r\n",
                "type": "post",
                "created_at": 1404524177,
                "updated_at": 1404573254
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "209",
            "_score": 1.8702718,
            "_source": {
                "id": 209,
                "title": "Dusk and Homestead",
                "body": "Working on learning [Dusk](https:\/\/laravel.com\/docs\/5.4\/dusk#introduction) and really excited to get going with it.\r\n\r\nBut running it in homestead proved to be a bit tricky.\r\n\r\nAfter following the docs and running `php artisan dusk` not much happened. Sure if I ran it on my Mac and it just worked but my tests needed to do migrations and what not and I want to keep my work in Homestead.\r\n\r\nSo a few steps later and it worked thanks to this post [https:\/\/github.com\/laravel\/dusk\/issues\/50#issuecomment-275155974](https:\/\/github.com\/laravel\/dusk\/issues\/50#issuecomment-275155974)\r\n\r\n## Local host file\r\n\r\nMake sure to edit `sudo vim \/etc\/hosts` and add the APP_URL there as well\r\n\r\n```\r\n127.0.0.1 webforms.dev\r\n```\r\n\r\nThen make sure you can hit it from inside homestead as well.  \r\n\r\n`curl -X GET http:\/\/webforms.dev`\r\n\r\n\r\nAll set?\r\n\r\n\r\n## Then run xvfb\r\n\r\nThis is a virtual frame buffer that Chrome runs in. Pretty cool really [https:\/\/en.wikipedia.org\/wiki\/Xvfb](https:\/\/en.wikipedia.org\/wiki\/Xvfb)\r\n\r\nSo I like to use screen to start a new session\r\n\r\n`screen -S running_xvfb`\r\n\r\nand then in there run\r\n\r\n`Xvfb :0 -screen 0 1280x8000x24 &`\r\n\r\nNow we want to swap back to our default session `CTRL+A` then still holding CTRL let go of A and press D.\r\n\r\nYou are back at your default terminal\r\n\r\nType:\r\n\r\n```\r\nvagrant@homestead:~\/Code\/webforms$ screen -ls\r\nThere is a screen on:\r\n\t16315.running_xvfb\t(04\/24\/2017 12:34:09 AM)\t(Detached)\r\n1 Socket in \/var\/run\/screen\/S-vagrant.\r\n```\r\n\r\nNow it all just worked!\r\n\r\n\r\n",
                "type": "post",
                "created_at": 1492994878,
                "updated_at": 1497011489
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "159",
            "_score": 1.8628951,
            "_source": {
                "id": 159,
                "title": "Laravel 5.1 and Oauth",
                "body": "# Laravel 5.1 and Oauth2 Server\r\n\r\n\r\nVideo coming soon...\r\n\r\nExample repo is here [https:\/\/github.com\/alnutile\/oauth_how_to](https:\/\/github.com\/alnutile\/oauth_how_to)\r\n\r\nThe library we will use is \r\n\r\n[https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel)\r\n\r\nThis will setup a server both client_type and password_type for Grant Types.\r\n\r\n# Coming to Terms with Oauth\r\n\r\nComing to terms with this stuff is long and tedious.\r\nThe docs are here [https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel\/](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel\/) wiki will help and then these lead to the League docs as well [http:\/\/oauth2.thephpleague.com\/](http:\/\/oauth2.thephpleague.com\/) \r\n\r\nThere is also a podcast interview with the Alex Bilbie who made the League Oauth Library [http:\/\/fullstackradio.com\/episodes\/4\/](http:\/\/fullstackradio.com\/episodes\/4\/)\r\n\r\nWhat I will cover is mainly the instalation going beyond the docs above into the details of getting this thing going. I will also provide a \"play\" repo for you to review.\r\n\r\n## Base Laravel Install \r\n\r\nIf you want to use this demo to play around just run `composer install` and see the migration info below.\r\n\r\nInstall laravel as normal, install the library as normal. You will see some extra stuff I have in the repo for helping out as well (this will be seen in the video too)\r\n\r\n`app\/OauthTools`\r\n\r\nSome commands to use artisan to make users, tokens etc.\r\n\r\nSo in the end my `app\/Console\/Kernel.php` looked like [https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/Console\/Kernel.php](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/Console\/Kernel.php)\r\n\r\nSo I could easily do\r\n\r\n~~~\r\nphp artisan oauth-tools:adduser admin@foo.com\r\n~~~\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/4oz4yn8p8gxftt2\/make_user_oauth.png?dl=0)\r\n\r\nor \r\n\r\n~~~\r\nphp artisan oauth-tools:generate-token 33591b34-03c2-4ece-a763-d531aee0298a admin@foo.com client\r\n~~~\r\n\r\nAlso note [composer.json](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/composer.json) I use a uuid library to help with these commands etc.\r\n\r\n\r\nFinally to have all of this work out of the box with the Postman file I shared run it this way for now\r\n\r\n~~~\r\ncd public\r\nphp -S localhost:8181\r\n~~~\r\n\r\nThe database for this example is sqlite so\r\n\r\n~~~\r\ntouch storage\/database.sqlite\r\nphp artisan migrate:refresh --seed\r\n~~~\r\n\r\nAnd you should now have a db and migrations\r\n\r\nSince it is sqlite just rm the file and touch it again to re-migrate and save your self the headache of DBAL driver etc since this just just a quick working demo.\r\n\r\n## Setup your oauth config\r\n\r\n`config\/oauth2.php` file as seen [here](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/config\/oauth2.php) **BUT** only if you want these. And my `access_token_ttl` is way too big so see the defaults in the docs. Also note it points to [OauthPasswordVerifier](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/OauthPasswordVerifier.php) which the docs talk about as well.\r\n\r\n## Route\r\n\r\nAs noted you add the code to your route \r\n\r\n~~~\r\nRoute::post('oauth\/access_token', function() {\r\n    return Response::json(Authorizer::issueAccessToken());\r\n});\r\n\r\n\r\nRoute::get('test', ['middleware' => 'oauth', function() {\r\n    return Response::json(\"Welcome\");\r\n}]);\r\n~~~\r\n\r\nLater on you will see this instead\r\n\r\n~~~\r\nRoute::post('oauth\/access_token', function() {\r\n    return Response::json(Authorizer::issueAccessToken());\r\n});\r\n\r\n\r\nRoute::get('test', ['middleware' => 'oauthOrAuth', function() {\r\n    return Response::json(\"Welcome\");\r\n}]);\r\n~~~\r\n\r\nWith the **oauthOrAuth** I will explain that in the video as well. But basically and api endpoint can be used by a local session based user and a remote application using oauth. It is just how our APIs go.\r\n\r\nSo this lets that work just fine.\r\n\r\n## Postman \r\n\r\nJust to show it all working you will see in the video me using postman. You will see that in the repo [here](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/oauth_try_2.json.postman_collection)\r\n\r\n\r\n## Now What\r\n\r\nBetween the links above and Postman you have a working \r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/bbt0fmfflm2zq7x\/oauth_token.gif?dl=0)\r\n\r\n\r\n",
                "type": "post",
                "created_at": 1439521108,
                "updated_at": 1439521242
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "113",
            "_score": 1.8518908,
            "_source": {
                "id": 113,
                "title": "Laravel 4.2 and Dotenv to set environment",
                "body": "To start using Dotenv now it is very simple.\r\n\r\n# One include the library\r\n\r\n~~~\r\n#composer.js\r\n\t\"require\": {\r\n          \"laravel\/framework\": \"4.2.*\",\r\n          \"vlucas\/phpdotenv\": \"1.0.*@dev\"\r\n    },\r\n~~~\r\n\r\n# Two update your start.php\r\n\r\n~~~\r\n#bootstrap\/start.php line 27\r\nDotenv::load(__DIR__ .'\/..\/');\r\n\r\n\r\n$env = $app->detectEnvironment(\r\n    function()\r\n    {\r\n        return getenv('APP_ENV');\r\n    }\r\n);\r\n\r\n~~~\r\n\r\n# Make sure to set your .env file\r\n\r\n~~~\r\n#.env\r\nAPP_ENV='local'\r\n~~~\r\n\r\nThat is it you are set to use it for all your environments.\r\n\r\n\r\n**Update**\r\n\r\nFor Heroku I used this instead\r\n\r\n~~~\r\n$env = $app->detectEnvironment(\r\n    function()\r\n    {\r\n        if(!isset(getenv('APP_ENV')))\r\n        {\r\n            Dotenv::load(__DIR__ .'\/..\/');\r\n        }\r\n        return getenv('APP_ENV');\r\n    }\r\n);\r\n~~~\r\n\r\nSetting the initial APP_ENV using heroku config:set APP_ENV=stage\r\n",
                "type": "post",
                "created_at": 1415530865,
                "updated_at": 1426207406
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "226",
            "_score": 1.8518908,
            "_source": {
                "id": 226,
                "title": "PostMark SMTP for sending Notifications and Password Resets",
                "body": "I have been using PostMark for years [https:\/\/postmarkapp.com](https:\/\/postmarkapp.com)\r\nfor sending emails, e.g. password reset and more.\r\n\r\nThey have an API but to get going with SMTP all the info is [here](https:\/\/postmarkapp.com\/developer\/user-guide\/sending-email\/sending-with-smtp)\r\n\r\nBasically get your KEY and use it in your .env like this:\r\n\r\n```\r\nMAIL_DRIVER=smtp\r\nMAIL_HOST=smtp.postmarkapp.com\r\nMAIL_PORT=587\r\nMAIL_USERNAME=foo\r\nMAIL_PASSWORD=foo\r\nMAIL_ENCRYPTION=tls\r\n```\r\n\r\nAnd all should work. Just make sure to \r\n\r\n  * Register the domain in their domain ui \r\n  * Set the from info in Laravel",
                "type": "post",
                "created_at": 1513218963,
                "updated_at": 1513218963
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "112",
            "_score": 1.8469967,
            "_source": {
                "id": 112,
                "title": "Speeding up PHPunit tests and Behat in Laravel for Database refreshes",
                "body": "This [article](http:\/\/www.chrisduell.com\/blog\/development\/speeding-up-unit-tests-in-php\/) covers some good tips on this. Ideally you do not hit the database in unit tests but sometimes you do. Also in behat it hits the db all the time since it is at the Acceptance level.\r\n\r\n# Sqlite\r\n\r\nIt is a great database and works. We easily can use it on running tests. When seeding the db I have my main seeding class doing this\r\n\r\n~~~\r\n<?php\r\n\r\nuse Illuminate\\Database\\Seeder;\r\nuse Illuminate\\Database\\Eloquent\\Model;\r\nuse Illuminate\\Support\\Facades\\App;\r\nuse Illuminate\\Support\\Facades\\Config;\r\nuse Illuminate\\Support\\Facades\\DB;\r\n\r\nclass DatabaseSeeder extends Seeder {\r\n\r\n\t\/**\r\n\t * Run the database seeds.\r\n\t *\r\n\t * @return void\r\n\t *\/\r\n\tpublic function run()\r\n\t{\r\n\t\tModel::unguard();\r\n\r\n        if(App::environment() != 'testing') {\r\n            DB::statement('SET FOREIGN_KEY_CHECKS=0;');\r\n        }\r\n\r\n        $this->call('AppTableSeeder');\r\n        $this->call('ParentRequestExample');\r\n        $this->call('ProductionSeeder');\r\n        if(App::environment() != 'testing') {\r\n            DB::statement('SET FOREIGN_KEY_CHECKS=1;');\r\n        }\r\n\r\n\r\n\t}\r\n\r\n}\r\n\r\n~~~\r\n\r\nSince sqlite does not like this we skip it for it but not for production etc.\r\n\r\nSecond my config\/testing\/database.php looks like this (as noted in the article)\r\n\r\n~~~\r\n<?php\r\n\r\n\r\nreturn [\r\n    \r\n    'default' => 'sqlite',\r\n\r\n    'connections' => [\r\n\r\n        'mysql' => [\r\n            'driver'    => 'mysql',\r\n            'host'      => $_ENV['DB_URL'],\r\n            'database'  => $_ENV['DB_NAME'],\r\n            'username'  => $_ENV['MYSQL_USER'],\r\n            'password'  => $_ENV['MYSQL_PASSWORD'],\r\n\r\n            'charset'   => 'utf8',\r\n            'collation' => 'utf8_unicode_ci',\r\n            'prefix'    => '',\r\n        ],\r\n\r\n        'pgsql' => [\r\n            'driver'   => 'pgsql',\r\n            'host'     => 'localhost',\r\n            'database' => 'homestead',\r\n            'username' => 'homestead',\r\n            'password' => 'secret',\r\n            'charset'  => 'utf8',\r\n            'prefix'   => '',\r\n            'schema'   => 'public',\r\n        ],\r\n\r\n        'setup' => array(\r\n            'driver' => 'sqlite',\r\n            'database' => __DIR__.'\/..\/..\/database\/stubdb.sqlite',\r\n            'prefix' => '',\r\n        ),\r\n\r\n        'sqlite' => array(\r\n            'driver'   => 'sqlite',\r\n            'database' => __DIR__ . '\/..\/..\/database\/testing.sqlite',\r\n            'prefix'   => '',\r\n        ),\r\n\r\n    ],\r\n\r\n];\r\n~~~\r\n\r\nWhich makes the below seeding command to setup the stub db work\r\n\r\n~~~\r\nphp artisan migrate:refresh --seed --database=\"setup\" --env=\"testing\"\r\n~~~\r\n\r\n# PHPUnit\r\n\r\nWhat I ended up with is a base TestCase like this\r\n\r\n~~~\r\n\r\n    public function setUp()\r\n    {\r\n        parent::setUp();\r\n        $this->faker = Faker::create();\r\n        $this->prepareForTests();\r\n    }\r\n\r\n    private function prepareForTests()\r\n    {\r\n        if(!file_exists(base_path() . '\/app\/database\/testing.sqlite'))\r\n        {\r\n            $this->refreshDb();\r\n        }\r\n    }\r\n\r\n    public function refreshDb()\r\n\r\n    {\r\n        copy(base_path() . '\/app\/database\/stubdb.sqlite', base_path() . '\/app\/database\/testing.sqlite');\r\n    }\r\n\r\n~~~\r\n\r\nAnd with any new migrations I run this command\r\n\r\n~~~\r\nphp artisan migrate:refresh --seed --database=\"setup\" --env=\"testing\"\r\n~~~\r\n\r\nThat file is kept in git since it is just seed data. If there are any conflicts just rm and start over. Testing.sqlite is not kept in git.\r\n\r\n#Behat\r\n\r\nBehat is the same idea. In the main FeatureContext file I have\r\n\r\n~~~\r\n\r\n    \/**\r\n     * @Given \/^I reseed the database$\/\r\n     *\/\r\n    public function iReseedTheDatabase()\r\n    {\r\n        try\r\n        {\r\n            dd(getenv('APP_ENV'));\r\n            \/\/exec(\"php artisan migrate:refresh --seed\");\r\n            copy(__DIR__ . '\/..\/..\/..\/..\/database\/stubdb.sqlite', __DIR__ . '\/..\/..\/..\/..\/database\/testing.sqlite');\r\n        }\r\n        catch(\\Exception $e)\r\n        {\r\n            throw new \\Exception(sprintf(\"Error seeding the database %s\", $e->getMessage()));\r\n        }\r\n    }\r\n~~~\r\n\r\nSo as we test the ui or api we can reload the data.\r\n\r\n#Behat \/ Laravel\r\n\r\nThis package [https:\/\/github.com\/GuilhermeGuitte\/behat-laravel](https:\/\/github.com\/GuilhermeGuitte\/behat-laravel)\r\n\r\nThis integrates behat into artisan command line helping with environment settings for behat.",
                "type": "post",
                "created_at": 1415275094,
                "updated_at": 1415275267
            }
        },
        {
            "_index": "default",
            "_type": "content",
            "_id": "111",
            "_score": 1.8119364,
            "_source": {
                "id": 111,
                "title": "Angular Pusher Factory to Centralize Code (also using Laravel to set constants and properties)",
                "body": "This will cover\r\n\r\n  * Making an Angular factory to centralize Pusher setup in Angular\r\n  * Passing settings form Laravel to Angular (though could be just Angular and a .env file as well)\r\n  * Passing Constants into the Angular App to pass these settings around, in this case to the Pusher Factory.\r\n\r\n## Setup your constants\r\n\r\nThis is where I call in the info I need to use later on.\r\n\r\n~~~\r\n(function(){\r\n\r\n  function config($stateProvider, $urlRouterProvider) {\r\n      $urlRouterProvider.otherwise(\"\/dashboard\");\r\n      $stateProvider\r\n          .state('dashboard', {\r\n              url: \"\/dashboard\",\r\n              views: {\r\n                '': {\r\n                    controller: 'DashCtrl',\r\n                    controllerAs: 'vm',\r\n                    resolve: {\r\n                        reports: ['ReportsService', function(ReportsService)\r\n                        {\r\n                            return ReportsService.get();\r\n                        }]\r\n                    },\r\n                    templateUrl: \"\/assets\/js\/dashboard\/templates\/dashboard.html\"\r\n                };\r\n  }\r\n\r\n  function constants() {\r\n     return { 'pusher_public_key': window.pusher_public_key }\r\n  }\r\n\r\nangular\r\n    .module('app')\r\n    .config(config)\r\n    .constant('ENV', constants())\r\n    .run(function($rootScope, $state) {\r\n        $rootScope.$state = $state;\r\n    });\r\n})();\r\n~~~\r\n\r\nSo now we have the constants in place that are used by our factory below\r\n\r\n## The Pusher Factory \r\n\r\n~~~\r\n(function(){\r\n    'use strict';\r\n    function PusherService(ENV)\r\n    {\r\n        var vm = this;\r\n        vm.pusher = {};\r\n        vm.ENV = ENV; \/\/We set this up above on the constants area.\r\n        vm.channelSet = {};\r\n        vm.activate = activate;\r\n        vm._subscribeToChannel = _subscribeToChannel;\r\n        vm._channelBind = _channelBind;\r\n\r\n        vm.PusherService = {\r\n            setPusher: setPusher\r\n        };\r\n\r\n        vm.activate();\r\n\r\n        \/\/\/\/\r\n        function activate()\r\n        {\r\n            console.log(vm.ENV);\r\n            vm.pusher = new Pusher(vm.ENV.pusher_public_key);\r\n        }\r\n\r\n        function setPusher(channel, event, callback)\r\n        {\r\n            vm._subscribeToChannel(channel);\r\n            vm._channelBind(event, callback);\r\n        }\r\n\r\n        function _subscribeToChannel(channel)\r\n        {\r\n            vm.channelSet = vm.pusher.subscribe(channel);\r\n        }\r\n\r\n        function _channelBind(event_name, callback)\r\n        {\r\n            vm.channelSet.bind(event_name, callback);\r\n        }\r\n\r\n        return vm.PusherService;\r\n    }\r\n\r\n    angular.module('app')\r\n        .factory('PusherService', PusherService);\r\n})();\r\n~~~\r\n\r\n## Laravel now need to load the settings in the .env file so Angular can access them later. \r\n\r\nOf course this could purely be Angular.js loading them from a config file that is not in git but relative to a server, local dev area etc.\r\n\r\nI set this all up user [https:\/\/github.com\/laracasts\/PHP-Vars-To-Js-Transformer](https:\/\/github.com\/laracasts\/PHP-Vars-To-Js-Transformer)\r\n\r\nI run the config command *note the change*\r\n\r\n~~~\r\nphp artisan publish:config laracasts\/utilities\r\n~~~\r\n\r\nThen I edit that file\r\n\r\n~~~\r\nconfig\/packages\/laracasts\/utilities\/config.php\r\n~~~\r\n\r\nTo be\r\n\r\n~~~\r\n<?php\r\n\r\nreturn [\r\n\r\n    \/*\r\n    |--------------------------------------------------------------------------\r\n    | View to Bind JavaScript Vars To\r\n    |--------------------------------------------------------------------------\r\n    |\r\n    | Set this value to the name of the view (or partial) that\r\n    | you want to prepend the JavaScript variables to.\r\n    |\r\n    *\/\r\n    'bind_js_vars_to_this_view' => 'layouts\/main',\r\n\r\n    \/*\r\n    |--------------------------------------------------------------------------\r\n    | JavaScript Namespace\r\n    |--------------------------------------------------------------------------\r\n    |\r\n    | By default, we'll add variables to the global window object.\r\n    | It's recommended that you change this to some namespace - anything.\r\n    | That way, from your JS, you may do something like `Laracasts.myVar`.\r\n    |\r\n    *\/\r\n    'js_namespace' => 'window'\r\n\r\n];\r\n~~~\r\n\r\nThe resources\/views\/layouts\/main.blade.php the only trick here is any Angular related {{ brackets need to be @{{ to tell blade to ignore them.\r\n\r\nFinally my AngularController which renders the ONE page Laravel is in charge of besides login. \r\n\r\n~~~\r\n<?php namespace App\\Http\\Controllers;\r\n\r\nuse Laracasts\\Utilities\\JavaScript\\Facades\\JavaScript;\r\n\r\n\/**\r\n * @Middleware(\"auth\")\r\n *\/\r\nclass AngularController extends BaseController {\r\n\r\n\r\n    \/**\r\n     * @Get(\"dash\", as=\"dash\")\r\n     *\/\r\n\tpublic function index()\r\n\t{\r\n        JavaScript::put([\r\n            'pusher_public_key' => $_ENV['PUSHER_PUBLIC']]);\r\n\t\treturn view('layouts.main');\r\n\t}\r\n\r\n}\r\n~~~\r\n\r\nIf you have more than on View the share option might work [http:\/\/laravel.com\/docs\/master\/views](http:\/\/laravel.com\/docs\/master\/views)\r\n",
                "type": "post",
                "created_at": 1414114056,
                "updated_at": 1415541370
            }
        }
    ],
    "max_score": 2.545662,
    "data": [
        {
            "id": 59,
            "title": "Laravel Recipe Book published by Packt Publishing",
            "body": "One of two books I have coming out this year. Here is an intro from the book \r\n\r\n<blockquote>\r\nThe book is a blend of numerous recipes that will give you all the necessary tips you need to build an application. It starts with basic installation and configuration tasks and will get you up-and-running in no time. You will learn to create and customize your PHP app and tweak and re-design your existing apps for better performance. You will learn to implement practical recipes to utilize Laravel's modular structure, the latest method injection, route caching, and interfacing techniques to create responsive modern-day PHP apps that stand on their own against other apps. Efficient testing and deploying techniques will make you more confident with your Laravel skills as you move ahead with this book\r\n<\/blockquote>\r\n\r\n\r\n<h3>Reviews<\/h3>\r\n\r\n<a href=\"http:\/\/whatpixel.com\/best-laravel-books\/\" target=\"_blank\">Best Laravel Books From Beginner To Advanced PHP Development<\/a>\r\n\r\n<blockquote>\r\nThere\u2019s no denying the immense value of this book. If you\u2019re a beginner with some background in Laravel you can learn a lot from the Laravel 5.x Cookbook. Even if you\u2019re an advanced developer you may still learn a few things and use this book as a desk reference for common solutions.\r\n<\/blockquote>\r\n\r\n<a href=https:\/\/www.packtpub.com\/web-development\/laravel-5x-cookbook>Here is the link to Packt<\/a>",
            "type": "project",
            "created_at": 1473190538,
            "updated_at": 1479658973,
            "score": 2.545662
        },
        {
            "id": 107,
            "title": "Design Guide - Controllers, Services and IOC",
            "body": "Design Guides\r\n---\r\n\r\n  - Controllers - contains application logic and passing user input data to service\r\n  - Services - The middleware between controller and repository. Gather data from controller, performs validation and business logic, and calling repositories for data manipulation.\r\n  - Repositories - layer for interaction with models and performing DB operations\r\n  - Models - common laravel model files with relationships defined\r\n  \r\n# In and Out Burgers\r\n\r\nBetween the user's request and the response is the application. The above design guide not only gives us a consistent, flexible way to manage a requests and responses from a web user but then leads us into creating applications that can manage consul request as well.\r\n\r\n![in and out](https:\/\/docs.google.com\/drawings\/d\/1D601St_IuaZ8FKW2eXQYqE2vHqZxRRLtmB8eGpQw8Aw\/pub?w=761&h=296)\r\n\r\n\r\nStarting with the book by the Author of Laravel, Tyler Otwell\r\n\r\n[book laravel](https:\/\/leanpub.com\/laravel)\r\n\r\nThe great thing about this book is that it is not really about Laravel but about SOLID design principles\r\n\r\n  * Single responsibility principle\r\n  * Open\/closed principle\r\n  * Liskov substitution principle\r\n  * Interface segregation principle\r\n  * Dependency inversion principle\r\n\r\n[wikipedia solid](http:\/\/en.wikipedia.org\/wiki\/SOLID_(object-oriented_design)\r\n\r\n# Change to scope does not cause bad code, bad design patterns cause bad code.\r\n\r\n*Scope changes and that is fine.* This is key to the success of an application. It must change with the vision of the Product owner as deliverables bring to light what could not be seen on paper, mock ups, whiteboards etc.\r\n\r\nIf we follow the Solid Design Principles then \"change is okay\" and easy.\r\n\r\n# Back to the book \"Laravel: from Apprentice to Artisan\r\n\r\nSo Tyler Otwell goes over each principle showing them in context of Laravel.\r\n\r\nHere are some key design patters to grasp\r\n\r\n## IOC\r\n\r\nInversion of control is fundamental to a flexible application that meets the 5 goals above. By \"coding to an interface\" we can not only work faster as a team but adapt to change easily.\r\n\r\nHow to get here?\r\n\r\nOther than reading the book consider this common example. \r\n\r\n\"Build A Contract\" Taylor Otwell. Laravel: From Apprentice To Artisan (Kindle Location 75 to 185). leanpub.com. \r\n\r\nBy hooking an Interface into the Service Provider we can attach any implementation we want to that interface.\r\n\r\nThis means someone can be working on one part of the app talking to another part that is not even done yet cause they can mock out the responses based on an Interface.\r\n\r\nUsing \r\n\r\n~~~\r\nphp artisan make:provider BillingInterface\r\n~~~\r\nYou will easily setup the class to start with in the app\/Providers folder\r\n\r\nLaravel 5 is taking this to the next level with \"Contracts\/Interfaces\" as a big part of the framework.\r\n\r\n[laracasts contracts](https:\/\/laracasts.com\/series\/whats-new-in-laravel-5\/episodes\/7)\r\n\r\n\r\nThis also means we can easily swap out classes as needed. The book goes over Billing we have another example Queue. We are using Beanstalkd to work locally and Amazon SQS to work on production. This is all done via such design patters. Interfaces\/Contracts around talking to a queue.\r\n\r\n# Controllers\r\n\r\nA request comes in and it sends it to the right service. Finally it delivers the response. Below is an example of what a method in a controller should have and no more.\r\n\r\n~~~\r\napp\/Http\/Controllers\/ProjectsController.php:31\r\n    public function index()\r\n    {\r\n        try\r\n        {\r\n            $results = $this->service->getAllProjectsForThisUser();\r\n            return Response::json($this->responseServices->respond($results, \"Loaded Projects\"), 200);\r\n        }\r\n        catch(\\Exception $e) {\r\n            return Response::json($this->responseServices->respond($e->getMessage(), \"Error Getting Project Failed\"), 422);\r\n        }\r\n\r\n    }\r\n~~~\r\n\r\nIt traps any errors and responds as needed to that error.\r\n\r\n## Issues with above?\r\n\r\nYes! Error codes should come from the Service as well. How does the controller know a 422? \r\n\r\n### Service then does what?\r\n\r\nAs defined above \r\n\r\n\"The middleware between controller and repository. Gather data from controller, performs validation and business logic, and calling repositories for data manipulation.\"\r\n\r\n  * Validation\r\n  * Business Logic\r\n  * Calling Repositories\r\n  * Transform Data in and out \r\n  * Lastly returns the results with a know error code.\r\n  \r\nSince 422 is an HTTP Response \r\n\r\n~~~\r\nvendor\/symfony\/http-foundation\/Symfony\/Component\/HttpFoundation\/Response.php:64\r\n~~~\r\n\r\nWe should have possible a response transformer class to consider the non HTTP response. Then let the Controller pick from that to find its related HTTP response. See the [Build API's You Wont't Hate](https:\/\/leanpub.com\/build-apis-you-wont-hate) for more on that. Covered in the other guide shortly too.\r\n\r\n",
            "type": "post",
            "created_at": 1411380890,
            "updated_at": 1411380970,
            "score": 2.2365978
        },
        {
            "id": 86,
            "title": "Simple Laravel CMS Example",
            "body": "## Quick intro to Laravel using a custom CMS app I made\r\n\r\nThe repo is [here](https:\/\/github.com\/alnutile\/l4cms)\r\n \r\n![intro](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/intro_image.png?_subject_uid=54803135&w=AADdI8YLw5iRjK91_3LjSHq7b7z0ibM8KY4P7MicRH9UFA)\r\n\r\nThis is mainly to show an example of a small CMS being built in Laravel. CMS (Content Management System) that is at it's most basic level, Authentication, Simple Content Types etc.\r\n\r\nWhat we will cover.\r\n\r\n  * Installing the \"CMS\" and what Page Types it comes with\r\n  * Looking at the folder layout \"Where is....\"\r\n  * App config setting up the site\r\n  * PHP Artisan command to migrate the site\r\n  * Routes\r\n  * Page example looking at the wysiwyg, Controller, View etc\r\n  * Tags - lets add a many to many relationship\r\n  \r\n\r\nThis is NOT the end all setup just an example. There are links below to quality videos, blogs posts docs etc to take you to the next level, not only in Laravel but just Object Oriented Design and good Architecture in general.\r\n\r\nNote the theme has it's own license and you need to purchase it [here](https:\/\/wrapbootstrap.com\/theme\/colorfrog-WB01PG0H4) in order to use it.\r\n\r\n## Install the \"CMS\" and what Page Types it comes with\r\n\r\nThe repo is here https:\/\/github.com\/alnutile\/cms\r\n\r\nIn time I will add more features but it really is an app that was made for a client that the base of it I wanted to fork off for later use.\r\n\r\nRun the basic laravel install steps noted on their site http:\/\/laravel.com\/docs\/quick\r\n\r\n## What Page Types\r\n\r\n * Pages are the main landing pages for most of the site with a slug to manage the url [1]. More on Pages shortly.\r\n * Portfolios was how this project started. Basically you make One and then make projects that reference it. \r\n * Projects are just that. They fit in a Portfolio\r\n * Menu Sorting there is an admin area for menu sorting as well. Right now it is just for the top left menu. (not the black top nav)\r\n \r\nAll these \"Admin\" links can be seen below\r\n\r\n![admin_bar](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/admin_link.png?_subject_uid=54803135&w=AAAXvu_aZZUUGLFbgByRli-WjFgDpVmUDnQxverzi5_ISg)\r\n\r\n\r\n### Every landing page is a Page \r\n\r\nEvery URLs is Page, Project or Portfolio so the editor can always edit the description of the page even if there is a \"collection\" under it. For example \/all_projects is a Page that just happens to also show a collection of \"Projects\" under it. Ideally this will be a less hard coded relationship BUT this particular example just needed a simple data set.\r\n\r\n\r\nThere are Portfolio and Project pages as well that the edit can edit the description on etc.\r\n\r\n\r\n## Looking at the folder layout\r\n\r\nThis is a standard Laravel App. The one key folder is **app\/CMS** for some items. But otherwise the Controllers, Models etc have all the needed data. [2]\r\n\r\nIn app\/CMS there is the Menu Facade, and the MenuService to make managing the menu system easier. [3]\r\n\r\nThe system puts it's uploaded files under public\/img in settings, banners etc\r\n\r\n## App config setting up the site\r\n\r\nThe app default to sqlite and the bootstrap\/start.php will default to local without you needing to set anything.\r\n\r\nRunning migrations will get you a good sample set of data. You can always turn this off in app\/database\/seeds\r\n\r\nIn the app\/database\/seeds\/UsersTableSeeder.php file is the admin and test user emails and passwords to login.\r\n\r\n## Routes\r\n\r\nThe app\/routes.php is where you can manage routes and see what is there right now. \r\n\r\n## Page Example\r\n\r\nYou can edit a page or add a page.\r\n\r\nOnce in there you will see this\r\n\r\n![image_page_edit](https:\/\/dl-web.dropbox.com\/get\/Screenshots\/edit.png?_subject_uid=54803135&w=AADonXAFhGpiKY5JL9u6d248TPQKJMPCDcHTwUi2s2Hk5Q)\r\n\r\n\r\n\r\nYou can give the page a title, SEO title, upload images and files via the wysiwyg and set the slug (Published coming soon so there can be a workflow)\r\n\r\n## Tags\r\n\r\nThere is a tagging feature that does not yet have the UI setup. (coming soon). The resource is setup but needs to be placed in the view\r\n\r\nIn php artisan tinker we can mess around with tags thought\r\n\r\n~~~\r\n\r\nphp artisan tinker\r\n$tag = new Tag(['name' => \"Test 4\"]);\r\nPortfolio::find(1)->tags()->save($tag);\r\nPortfolio::find(1)->tags->toArray();\r\nTag::find(1)->portfolios->toArray();\r\nPortfolio::find(1)->tags()->detach(1);\r\nPortfolio::find(1)->tags()->attach(1);\r\n~~~\r\n\r\nSo we are making a tag, saving it to Portfolio 1. Seeing it attached to Portfolio 1 and Seeing Portfolios attached to it.\r\n\r\n## Links\r\n\r\n * Great videos on Laravel, Oop and design patters https:\/\/laracasts.com\/\r\n * Laravel own docs are great http:\/\/laravel.com\/docs\r\n * Forums and Chat room http:\/\/laravel.io\/forum\r\n * Great overview of Laravel app building http:\/\/culttt.com\/2013\/04\/29\/getting-started-with-laravel-4\/\r\n \r\n\r\n## Footnotes\r\n\r\n  * [1] This will be refactored shortly\r\n  * [2] This will be moved shortly to make it way more extendable but leaving the core easy to manage.\r\n  * [3] Refactor this out so menu is a manyToMany relationship with the models that will use it.\r\n",
            "type": "post",
            "created_at": 1401749386,
            "updated_at": 1401749421,
            "score": 2.129662
        },
        {
            "id": 163,
            "title": "Spark Setup Issue",
            "body": "During the install [https:\/\/github.com\/laravel\/spark](https:\/\/github.com\/laravel\/spark) I kept getting this error\r\n\r\n~~~\r\n Problem 1\r\n    - Installation request for laravel\/spark-installer ~1.0 -> satisfiable by laravel\/spark-installer[v1.0.0].\r\n    - Conclusion: remove illuminate\/support v4.2.17\r\n    - laravel\/spark-installer v1.0.0 requires illuminate\/support ~5.0 -> satisfiable by illuminate\/support[v5.0.0, v5.0.22, v5.0.25, v5.0.26, v5.0.28, v5.0.33, v5.0.4, v5.1.1, v5.1.13, v5.1.16, v5.1.2, v5.1.6, v5.1.8].\r\n    - Can only install one of: illuminate\/support[v5.0.0, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.22, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.25, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.26, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.28, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.33, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.0.4, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.1, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.13, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.16, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.2, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.6, v4.2.17].\r\n    - Can only install one of: illuminate\/support[v5.1.8, v4.2.17].\r\n    - Installation request for illuminate\/support == 4.2.17.0 -> satisfiable by illuminate\/support[v4.2.17].\r\n~~~\r\n\r\nFinally I went into my ~\/.composer folder. Removed `composer.lock` then I edited the `composer.json` to look like this\r\n\r\n~~~\r\n{\r\n    \"require\": {\r\n        \"laravel\/envoy\": \"~1.0\",\r\n        \"laravel\/installer\": \"~1.1\",\r\n        \"laravel\/spark-installer\": \"~1.0\"\r\n    }\r\n}\r\n~~~\r\n\r\nI use Envoy for a lot of my projects so I left that there and made sure to update my installer.\r\n\r\nThen I ran, in that folder composer update.\r\n\r\nFinally I made sure to add the path to my ~\/.bash_profile as \r\n\r\n~~~\r\nexport PATH=$PATH:\/Users\/alfrednutile\/.composer\/vendor\/bin\/\r\n~~~\r\n\r\nThen ran `source ~\/.bash_profile` \r\n\r\nWith all that in place I could go to my new Laravel install to run `spark install`",
            "type": "post",
            "created_at": 1442321916,
            "updated_at": 1442321916,
            "score": 2.1186712
        },
        {
            "id": 181,
            "title": "Getting Going Quickly Windows, Behat and Selenium",
            "body": "Quick Install Steps\r\n\r\n## Vagrant and Homestead \r\n\r\nThis was easy I just followed these steps [here](http:\/\/sherriflemings.blogspot.ca\/2015\/03\/laravel-homestead-on-windows-8.html) and I was done. For me I used Vmware but Virtualbox is fine.\r\n\r\n## Windows in Selenium\r\n\r\nTwo easy steps\r\n\r\n### Step 1 Install Node.js SUPER EASY\r\n\r\n[https:\/\/nodejs.org\/en\/download\/](https:\/\/nodejs.org\/en\/download\/)\r\n\r\nInstall the .exe, restart your console and you have node!\r\n\r\n### Step 2 Install Selenium\r\n\r\nJust go here and you are done!\r\n[https:\/\/www.npmjs.com\/package\/selenium-standalone](https:\/\/www.npmjs.com\/package\/selenium-standalone)\r\n\r\nAfter those steps I run it in a powershell and the server is running and I am set to use it.\r\n\r\n## Final Touches\r\n\r\nIn my VM I \"sudo vim \/etc\/hosts\" and point it to my selenium on windows using the domain \"selenium.dev\"\r\n\r\n~~~\r\n192.168.7.57    selenium.dev\r\n~~~\r\n\r\nThen my behat.yml looks like this\r\n\r\nSo when I run this inside the VM it knows to talk to the exteral version of Selenium \r\n\r\n~~~\r\ndefault:\r\n    suites:\r\n        home_ui:\r\n            paths: [ %paths.base%\/features\/home]\r\n            contexts: [ HomePageUiContext ]\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            env_path: .env.behat\r\n        Behat\\MinkExtension:\r\n            default_session: laravel\r\n            base_url: https:\/\/recipes.dev\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/selenium.dev:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n~~~\r\n\r\nYou can see more of it [here](https:\/\/github.com\/alnutile\/recipes\/blob\/master\/behat.yml)\r\n\r\n ",
            "type": "post",
            "created_at": 1462296071,
            "updated_at": 1473357085,
            "score": 2.1127203
        },
        {
            "id": 76,
            "title": "Using Dot Env files to manage settings",
            "body": "Wow. Included in Laravel http:\/\/laravel.com\/docs\/configuration#protecting-sensitive-configuration\r\n\r\n1. removed due to old news\r\n\r\n2. [http:\/\/mattstauffer.co\/blog\/laravel-forge-using-environment-variables-for-environment-detection\/](http:\/\/mattstauffer.co\/blog\/laravel-forge-using-environment-variables-for-environment-detection\/)\r\n\r\n## Update\r\nI really like the second link and how it sets up a .env file first to just return a simple string. After that you can have the .env.production.php or .env.local.php that laravel can look for.\r\n\r\n~~~\r\n\/\/bootstrap\/start.php\r\n$env = $app->detectEnvironment(function()\r\n{\r\n    if (file_exists(__DIR__ . '\/..\/.env')) {\r\n        return include(__DIR__ . '\/..\/.env');\r\n    } else {\r\n        return 'production';\r\n    }\r\n});\r\n~~~\r\n\r\nQuite simple at that point to separate all of the environments.",
            "type": "post",
            "created_at": 1400410748,
            "updated_at": 1402143902,
            "score": 2.0853817
        },
        {
            "id": 236,
            "title": "Passing from Blade to VueJs",
            "body": "A lot of posts had [this](https:\/\/medium.com\/@m_ramsden\/passing-data-from-laravel-to-vue-98b9d2a4bd23) style.\r\n\r\nI ended up just needing this:\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/huucm3vx4uyklq7\/Screenshot%202018-02-23%2020.29.22.png?dl=0)\r\n\r\nThe controller simply does this:\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/qw7x7u7ayr7j441\/Screenshot%202018-02-23%2020.29.52.png?dl=0)",
            "type": "post",
            "created_at": 1519442724,
            "updated_at": 1519443006,
            "score": 2.018045
        },
        {
            "id": 109,
            "title": "Temporary Auth Updates L5",
            "body": "# Auth updates\r\n\r\nFirst make sure your composer update has the latest Laravel and check that\r\nthere are not relevant fixes already via laravel\/docs master laravel\/framework master or laravel\/laravel dev\r\n\r\nMoved evn files to the new format and only 1 is needed now having the\r\n\r\n~~~\r\nAPP_ENV='local' \r\n~~~\r\n\r\nsetting for the environment.\r\n\r\n\r\nThen update the path in the AuthController to go to auth\/login\r\n~~~\r\n#app\/Http\/Controllers\/Auth\/AuthController\r\n\r\n    public function login(LoginRequest $request)\r\n    {\r\n        if ($this->auth->attempt($request->only('email', 'password')))\r\n        {\r\n            return redirect('\/');\r\n        }\r\n\r\n        return redirect('\/auth\/login')->withErrors([\r\n            'email' => 'The credentials you entered did not match our records. Try again?',\r\n        ]);\r\n    }\r\n~~~\r\n\r\nHere is a good article on using annotations which are needed now in the controller.\r\n\r\n[http:\/\/mattstauffer.co\/blog\/laravel-5.0-route-annotations](http:\/\/mattstauffer.co\/blog\/laravel-5.0-route-annotations)\r\n\r\nFor example I remove api\/v1\/projects from routes.php (which is key it can not be in both)\r\n\r\nThen in the ProjectsController.php I added this to the top of the class\r\n\r\n~~~\r\n\/**\r\n * @Middleware(\"BehatEditor\\Http\\Middleware\\AuthMiddleware\")\r\n * @Before(\"auth\")\r\n *\/\r\nclass ProjectsController extends BaseController {\r\n~~~\r\n\r\n\r\nand in the index function\r\n\r\n~~~\r\n\r\n    \/**\r\n     * @Get(\"api\/v1\/projects\", as=\"api.v1.projects\")\r\n     * @return mixed\r\n     *\/\r\n    public function index()\r\n    {\r\n        try\r\n        {\r\n            $results = $this->service->getAllProjectsForThisUser();\r\n            \/**\r\n             * @TODO move Response to a class to not have it tightly coupled here\r\n             *\/\r\n            return Response::json($this->responseServices->respond($results, \"Loaded Projects\"), 200);\r\n        }\r\n        catch(\\Exception $e) {\r\n            return Response::json($this->responseServices->respond($e->getMessage(), \"Error Getting Project Failed\"), 422);\r\n        }\r\n\r\n    }\r\n~~~\r\n\r\nSo the route is now api\/v1\/projects using Get and the route name for ease of use is api.v1.projects\r\n\r\nThen I ran\r\n\r\n~~~\r\nphp artisan route:scan \r\n~~~\r\n\r\nto get this file made for me\r\n\r\n~~~\r\nstorage\/framework\/routes.scanned.php\r\n~~~\r\n\r\nInside we see\r\n\r\n~~~\r\n<?php \r\n\r\n$router->get('auth\/login', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@showLoginForm', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->post('auth\/login', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@login', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->get('auth\/logout', ['uses' => 'App\\Http\\Controllers\\Auth\\AuthController@logout', 'domain' => NULL, 'as' => NULL, 'middleware' => array (\r\n  0 => 'csrf',\r\n  1 => 'guest',\r\n), 'where' => array (\r\n)]);\r\n$router->get('api\/v1\/sites\/reports', ['uses' => 'App\\Http\\Controllers\\DashController@getDash', 'domain' => NULL, 'as' => 'sites.reports', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n$router->get('api\/v1\/projects', ['uses' => 'App\\Http\\Controllers\\ProjectsController@index', 'domain' => NULL, 'as' => 'api.v1.projects', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n$router->get('sites', ['uses' => 'App\\Http\\Controllers\\SitesController@index', 'domain' => NULL, 'as' => 'sites.index', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n\r\n~~~\r\n\r\nAll the App namespaces can really be your App or the default Laravel app files.\r\n\r\nThis file is auto generated from that command so do not edit it.\r\n\r\nThe one we just made is\r\n\r\n~~~\r\n$router->get('api\/v1\/projects', ['uses' => 'App\\Http\\Controllers\\ProjectsController@index', 'domain' => NULL, 'as' => 'api.v1.projects', 'middleware' => array (\r\n  0 => 'App\\\\Http\\\\Middleware\\\\AuthMiddleware',\r\n), 'where' => array (\r\n)]);\r\n~~~",
            "type": "post",
            "created_at": 1413123628,
            "updated_at": 1413124846,
            "score": 1.9809898
        },
        {
            "id": 168,
            "title": "Logout User After Inactivity Laravel and Milddleware",
            "body": "**Original Post** [http:\/\/laravel-tricks.com\/tricks\/session-timeout-for-logged-in-user](http:\/\/laravel-tricks.com\/tricks\/session-timeout-for-logged-in-user)\r\n\r\nThis Middleware made it super easy to satisfy a requirement to log the user out after 15 minutes of in activity.\r\n\r\nI added only a few touchups.\r\n\r\nOne was the `getTimeOut` this was so I can work locally and override this by setting it to a large number.  I could even use it to just bypass the whole things for a bit since on `local` I rather not deal with this. \r\n\r\nAlso I removed the message count since it just was not needed for what I was doing.\r\n\r\n\r\n~~~\r\n<?php namespace App\\Http\\Middleware;\r\nuse Closure;\r\nuse Illuminate\\Support\\Facades\\Auth;\r\nuse Illuminate\\Session\\Store;\r\nclass SessionTimeout {\r\n    protected $session;\r\n    protected $timeout=900;\r\n    public function __construct(Store $session){\r\n        $this->session=$session;\r\n    }\r\n    \/**\r\n     * Handle an incoming request.\r\n     *\r\n     * @param  \\Illuminate\\Http\\Request  $request\r\n     * @param  \\Closure  $next\r\n     * @return mixed\r\n     *\/\r\n    public function handle($request, Closure $next)\r\n    {\r\n        if(!$this->session->has('lastActivityTime'))\r\n            $this->session->put('lastActivityTime',time());\r\n        elseif(time() - $this->session->get('lastActivityTime') > $this->getTimeOut()){\r\n            $this->session->forget('lastActivityTime');\r\n            Auth::logout();\r\n            return redirect('auth\/login')->withErrors(['You had not activity in 15 minutes']);\r\n        }\r\n        $this->session->put('lastActivityTime',time());\r\n        return $next($request);\r\n    }\r\n\r\n    protected function getTimeOut()\r\n    {\r\n        return (env('TIMEOUT')) ?: $this->timeout;\r\n    }\r\n}\r\n~~~",
            "type": "post",
            "created_at": 1447485550,
            "updated_at": 1447485569,
            "score": 1.9800335
        },
        {
            "id": 124,
            "title": "Laravel Blade and Angular brackets",
            "body": "I use one AngularController.php to render main.blade.php file that then renders angular. The only other blade file is the login page.\r\nI could have done this in the routes.php file but since the routes file has the login page I decided to place it in this controller.\r\n\r\n\r\n~~~\r\n<?php namespace App\\Http\\Controllers;\r\n\r\n\r\nuse Illuminate\\Support\\Facades\\Blade;\r\nuse Illuminate\\Support\\Facades\\Config;\r\nuse Illuminate\\Support\\Facades\\View;\r\nuse Laracasts\\Utilities\\JavaScript\\Facades\\JavaScript;\r\n\r\n\r\n\/**\r\n * @Middleware(\"auth\")\r\n *\/\r\nclass AngularController extends BaseController {\r\n\r\n    use UserHelper;\r\n\r\n    \/**\r\n     * @var UserService\r\n     *\/\r\n    private $userService;\r\n\r\n    public function __construct(UserService $userService)\r\n    {\r\n        $this->userService = $userService;\r\n    }\r\n\r\n    \/**\r\n     * @Get(\"behat\", as=\"behat.dash\")\r\n     *\/\r\n\tpublic function index()\r\n\t{\r\n\r\n        Blade::setContentTags('<%', '%>'); \t\t\/\/ for variables and all things Blade\r\n        Blade::setEscapedContentTags('<%%', '%%>'); \t\/\/ for escaped data\r\n        $user_id = $this->getUserId();\r\n        $profile = $this->userService->getPerson($user_id);\r\n        $token = csrf_token();\r\n        $chat_on = Config::get('app.chat_on', true);\r\n        JavaScript::put(\r\n            [\r\n                'pusher_public_key' => $_ENV['PUSHER_PUBLIC'],\r\n                'sauce_key' => $_ENV['SAUCE_TOKEN'],\r\n                'sauce_user' => $_ENV['SAUCE_USER'],\r\n                'profile' => $profile,\r\n                'token' => $token,\r\n                'debug' => Config::get('app.debug'),\r\n            ]\r\n        );\r\n\t\treturn View::make('layouts.main', compact('chat_on'));\r\n\t}\r\n\r\n}\r\n~~~\r\n\r\nThanks to [http:\/\/scotch.io\/bar-talk\/quick-tip-using-laravel-blade-with-angularjs](http:\/\/scotch.io\/bar-talk\/quick-tip-using-laravel-blade-with-angularjs) for the tip",
            "type": "post",
            "created_at": 1418995150,
            "updated_at": 1418995150,
            "score": 1.965077
        },
        {
            "id": 151,
            "title": "Laravel 5.1 Behat and Codeship",
            "body": "The new integration testing features with Laravel 5.1 make Behat almost not needed BUT we do a lot of AngularJs work and instead of using karma to test the ui we enjoy using behat since we like the Gherkin Syntax and how we can easily code custom steps in PHP.\r\n\r\nHere are some steps to getting behat going on Codeship so you get full CI even of Angular.\r\n\r\nThis is all based off of [https:\/\/github.com\/laracasts\/Behat-Laravel-Extension](https:\/\/github.com\/laracasts\/Behat-Laravel-Extension)\r\n\r\n\r\n## Behat.yml\r\n\r\nbehat.yml looks like this for me\r\n\r\n~~~\r\ndefault:\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            # env_path: .env.behat\r\n        Behat\\MinkExtension:\r\n            base_url: https:\/\/microservicehub.dev:44300\r\n            default_session: laravel\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/192.168.10.1:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n\r\ncodeship:\r\n    extensions:\r\n        Laracasts\\Behat:\r\n            env_path: .env.codeship\r\n        Behat\\MinkExtension:\r\n            base_url: http:\/\/localhost:8080\r\n            default_session: laravel\r\n            laravel: ~\r\n            selenium2:\r\n              wd_host: \"http:\/\/localhost:4444\/wd\/hub\"\r\n            browser_name: chrome\r\n~~~\r\n\r\nThis is so I can run it locally as needed. The Codeship profile will then call in the `.env.codeship` and update the url as needed.\r\n\r\n## .env.codeship\r\n\r\nThis file has \r\n\r\n~~~\r\nAPP_ENV=testing\r\nAPP_DEBUG=true\r\nAPP_KEY=f5edkkfijPDKQXPLHyYNDhiNZZrpT0Qd\r\n\r\nDB_HOST=localhost\r\nDB_DATABASE=test\r\n\r\nCACHE_DRIVER=file\r\nSESSION_DRIVER=file\r\nQUEUE_DRIVER=sync\r\n\r\nMAIL_DRIVER=smtp\r\nMAIL_HOST=mailtrap.io\r\nMAIL_PORT=2525\r\nMAIL_USERNAME=null\r\nMAIL_PASSWORD=null\r\nMAIL_ENCRYPTION=null\r\n~~~\r\n\r\n## Build Script for Codeship\r\n\r\nUsing the code they offer on their site I add that to my projects folder under tests\/selenium_server.sh it is this file [here](https:\/\/github.com\/codeship\/scripts\/blob\/master\/packages\/selenium_server.sh)\r\n\r\nMaybe some do not need to be there?\r\n\r\n## Codeship Test Settings\r\n\r\nNow in the settings I end up with inside the CodeShip UI are as follows\r\n\r\nHere for example is the URL for my project to find these settings.\r\n\r\n`https:\/\/codeship.com\/projects\/8844\/configure_tests`\r\n\r\nUnder Setup Commands\r\n\r\n~~~\r\n# Set php version through phpenv. 5.3, 5.4 and 5.5 available\r\nphpenv local 5.5\r\n# Install dependencies through Composer\r\ncomposer config -g github-oauth.github.com foobar\r\ntouch .env\r\necho \"APP_ENV='testing'\" >> .env\r\necho \"DB_DATABASE='test'\" >> .env\r\necho \"MYSQL_TESTING_URL='localhost'\" >> .env\r\necho \"APP_KEY=DHMbPIbNLd1jI0ZEZZSxRFOHj03SU4P5\" >> .env\r\necho \"CACHE_DRIVER=file\" >> .env\r\necho \"SESSION_DRIVER=file\" >> .env\r\necho \"QUEUE_DRIVER=sync\" >> .env\r\necho \"MAIL_DRIVER=smtp\" >> .env\r\necho \"MAIL_HOST=smtp.mailgun.org\" >> .env\r\necho \"MAIL_PORT=2525\" >> .env\r\ncomposer install --dev\r\nphp artisan migrate\r\nphp artisan db:seed\r\nnohup bash -c \"sh tests\/selenium_server.sh &\" && sleep 9\r\ncd public && nohup bash -c \"php -S localhost:8080 &\" && sleep 9\r\ncd ..\/\r\n~~~\r\n\r\nUnder Configure Test\r\n\r\n~~~\r\nDB_DATABASE=test phpunit\r\nphp artisan migrate\r\nphp artisan db:seed\r\nvendor\/bin\/behat --profile=codeship --stop-on-failure\r\n~~~\r\n\r\nI run the migration one more time to get it ready for behat\r\n\r\n![behat](https:\/\/dl.dropboxusercontent.com\/s\/2uadht5426s40p8\/behat_codeship.png?dl=0)\r\n",
            "type": "post",
            "created_at": 1436020685,
            "updated_at": 1481767405,
            "score": 1.9487176
        },
        {
            "id": 49,
            "title": "Angular, Laravel CMS",
            "body": "Working on a full Saas solution for a client with Laravel, Angular and behat to make sure it stays working.\r\n\r\n<iframe width=\"640\" height=\"480\" src=\"https:\/\/www.youtube.com\/embed\/on9GAAIus_M\" frameborder=\"0\" allowfullscreen><\/iframe>",
            "type": "project",
            "created_at": 1398822938,
            "updated_at": 1454248086,
            "score": 1.9402648
        },
        {
            "id": 133,
            "title": "Dealing with Oauth2 Server and Laravel for both a local app login and for remote apps using Lucadegasperi\/oauth2-server-laravel",
            "body": "This is all based around this library [https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel)\r\n\r\nI am building and API to be used by an iOs and Android client I will be making soon. **But** I also needed the filter system to deal with my local Laravel view that was using the api via an Angular driven widget so the user can go to the website as well.\r\n\r\nSo the website is where the user can go to do change settings, subscription updates etc, but in that case they are logged in via the Laravel login form. From there they land on the profile page where the Angular widget will do n xhr request to the api to fill in the table\/settings.\r\n\r\nThe routes ends up looking like this \r\n\r\n~~~\r\n\r\nRoute::filter('setUser', function()\r\n{\r\n\tif(Auth::guest())\r\n\t{\r\n\t\t$user_id = Authorizer::getResourceOwnerId();\r\n\t\tAuth::loginUsingId($user_id);\r\n\t}\r\n});\r\n\r\n\/\/The view they see using Laravel Blade and an embedded angular widget\r\nRoute::get('profile', ['middleware' => 'auth', 'uses' => 'ProfileController@getProfile']);\r\n\r\n\/\/The API\r\nRoute::group(['prefix' => 'api\/v1', 'before' => 'oauth|setUser|auth'], function() {\r\n\tRoute::get('profile',  'ProfileController@getApiProfile');\r\n});\r\n~~~\r\n\r\nThe thing is the Oauth2 filter was causing some issues\r\n\r\n  1 Looks for a access_token query string or header\r\n  2 Does not load the user like I need\r\n\r\n\r\nThe first issue I just made a class to extend the core filter for the Oauth2 library.\r\n\r\n###  My provider \r\n\r\n~~~\r\n<?php namespace App\\Providers;\r\n\r\nuse App\\Filters\\OauthTotalRecalls;\r\nuse Illuminate\\Support\\ServiceProvider;\r\nclass OauthFilterProvider extends ServiceProvider {\r\n    public function boot()\r\n    {\r\n        $this->app->bindShared('LucaDegasperi\\OAuth2Server\\Filters\\OAuthFilter', function ($app) {\r\n            $httpHeadersOnly = $app['config']->get('oauth2.http_headers_only');\r\n            return new OauthTotalRecalls($app['oauth2-server.authorizer'], $httpHeadersOnly);\r\n        });\r\n    }\r\n    \/**\r\n     * Register the service provider.\r\n     *\r\n     * @return void\r\n     *\/\r\n    public function register()\r\n    {\r\n        \/\/ TODO: Implement register() method.\r\n    }\r\n}\r\n~~~\r\n\r\nThen I register that in my app.conf after I register his.\r\n\r\n### My Filter\r\n\r\nIt overrides the filter to do one thing and that is to check if the user is a guest. Which they would not be if they are logging in via the Laravel login form.\r\n\r\n~~~\r\n<?php namespace App\\Filters;\r\nuse Illuminate\\Support\\Facades\\Auth;\r\nuse LucaDegasperi\\OAuth2Server\\Filters\\OAuthFilter;\r\nclass OauthTotalRecalls extends OAuthFilter {\r\n    \/**\r\n     * Run the oauth filter\r\n     *\r\n     * @internal param mixed $route, mixed $request, mixed $scope,...\r\n     * @return void a bad response in case the request is invalid\r\n     *\/\r\n    public function filter()\r\n    {\r\n        if(Auth::guest())\r\n        {\r\n            if (func_num_args() > 2) {\r\n                $args = func_get_args();\r\n                $this->scopes = array_slice($args, 2);\r\n            }\r\n            $this->authorizer->validateAccessToken($this->httpHeadersOnly);\r\n            $this->validateScopes();\r\n        }\r\n    }\r\n}\r\n~~~\r\n\r\n### Loading user\r\n\r\nSo at this point the user is logged in via Laravel so the Auth::user() is fully set. But lastly if this was the token based log in the \"setUser\" filter will kick in and load the user from the token. If the token is wrong then this all will fail.\r\n\r\n~~~\r\nRoute::filter('setUser', function()\r\n{\r\n\tif(Auth::guest())\r\n\t{\r\n\t\t$user_id = Authorizer::getResourceOwnerId();\r\n\t\tAuth::loginUsingId($user_id);\r\n\t}\r\n});\r\n~~~\r\n",
            "type": "post",
            "created_at": 1424707047,
            "updated_at": 1424707307,
            "score": 1.9238532
        },
        {
            "id": 95,
            "title": "Many to Many Polymorphic Relations from Laravel to Angular and back",
            "body": "This will cover having a polymorphic relationship in Laravel, showing it on a form in Angular and saving it back to Laravel. Overall it is well documented [here](http:\/\/laravel.com\/docs\/eloquent#many-to-many-polymorphic-relations) at the great docs at Laravel but this post might help in a few areas.\r\n\r\nAs someone defines Polymorphic Relationships there\r\n\r\n>\"Polymorphic relations allow a model to belong to more than one other model, on a single association. For example, you might have a photo model that belongs to either a staff model or an order model. \"\r\n\r\n## Output the data to Angular\r\n\r\nTaking the User Model as an example I query the user but then before returning the data to Angular I append the polymorphic results. In this case we will call it Specialties\r\n~~~\r\nprotected function transformOutgoingData($data)\r\n    {\r\n        $data->specialties = $data->specialties()->getResults()->lists('id');\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nThis returns just an array to Angular to deal with. When sending it an Object trouble getting Angular to set the selected options. The hard part, since by default it just worked, was to send not only the 2 selected Specialties but the 20 other possible ones and make the list out of that.\r\n\r\n~~~\r\n#angular html file\r\n<div class=\"form-group\" ng-if=\"userHasAdminRole(user)\"  markdown=\"1\">\r\n        <label>Specialties:<\/label>\r\n        <select ng-options=\"specialty.id as specialty.name for specialty in user.specialties_all\"\r\n                name=\"specialty\"\r\n                multiple\r\n                ng-model=\"user.specialties\"\r\n                ng-required=\"true\"\r\n                class=\"form-control\">\r\n        <\/select>\r\n    <\/div>\r\n~~~\r\n\r\nThe specialties_all comes from the method I run on the data before output it which I do anyways on many data models. This comes right before the transformOutgoingData.\r\n\r\n~~~\r\n    protected function addDataToOutGoingModel($user)\r\n    {\r\n        $user = $this->addAllSpecialtiesToModel($user);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nThis way all my select lists on that page and other data lists, checkboxes etc have the data they need.\r\n\r\nFinally when the person clicks Submit it is sent back to Laravel. So far I could not just save or update the user with this info. For example\r\n\r\n~~~\r\n#app\/models\/User.php\r\n    public function update($user_id, $all)\r\n    {\r\n        $all = $this->transformIncomingData($all);\r\n        try {\r\n            $user = \\User::findOrFail($user_id);\r\n        }\r\n        catch(\\Expection $e){\r\n            throw new \\Exception(\"User not found\");\r\n        }\r\n\r\n        $user->update($all);\r\n        $user = $this->saveDataToModel($user);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nThe  $user->update($all); will crash with this extra \"specialties\" data coming in with this error.\r\n\r\n>\"preg_replace(): Parameter mismatch, pattern is a string while replacement is an array\"\r\n\r\nSo instead I do a step before and after\r\n\r\nBefore I run transformIncomingData and unset the $all['specialties'] key I get from Input::all() and save that to a property\r\n\r\n~~~\r\n    protected function transformIncomingData($data)\r\n    {\r\n        $data = ( isset($data['specialties'])) ? $this->transformSpecialtiesIncoming($data) : $data;\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nwhich goes to\r\n\r\n~~~\r\n    protected function transformSpecialtiesIncoming($data)\r\n    {\r\n        $this->original_specialities = $data['specialties'];\r\n        unset($data['specialties']);\r\n        return $data;\r\n    }\r\n~~~\r\n\r\nThen after I update the User I run saveDataToModel($user) which triggers this method\r\n\r\n~~~\r\n    protected function setSpecialties($user)\r\n    {\r\n        $user->specialties()->sync($this->original_specialities);\r\n        return $user;\r\n    }\r\n~~~\r\n\r\nFinally back to Angular with the results. \r\n\r\nAnother good way to tie all this together is the Model Observer Pattern noted here [http:\/\/laravel.com\/docs\/eloquent#model-observers](http:\/\/laravel.com\/docs\/eloquent#model-observers)\r\n\r\n",
            "type": "post",
            "created_at": 1404524177,
            "updated_at": 1404573254,
            "score": 1.9145033
        },
        {
            "id": 209,
            "title": "Dusk and Homestead",
            "body": "Working on learning [Dusk](https:\/\/laravel.com\/docs\/5.4\/dusk#introduction) and really excited to get going with it.\r\n\r\nBut running it in homestead proved to be a bit tricky.\r\n\r\nAfter following the docs and running `php artisan dusk` not much happened. Sure if I ran it on my Mac and it just worked but my tests needed to do migrations and what not and I want to keep my work in Homestead.\r\n\r\nSo a few steps later and it worked thanks to this post [https:\/\/github.com\/laravel\/dusk\/issues\/50#issuecomment-275155974](https:\/\/github.com\/laravel\/dusk\/issues\/50#issuecomment-275155974)\r\n\r\n## Local host file\r\n\r\nMake sure to edit `sudo vim \/etc\/hosts` and add the APP_URL there as well\r\n\r\n```\r\n127.0.0.1 webforms.dev\r\n```\r\n\r\nThen make sure you can hit it from inside homestead as well.  \r\n\r\n`curl -X GET http:\/\/webforms.dev`\r\n\r\n\r\nAll set?\r\n\r\n\r\n## Then run xvfb\r\n\r\nThis is a virtual frame buffer that Chrome runs in. Pretty cool really [https:\/\/en.wikipedia.org\/wiki\/Xvfb](https:\/\/en.wikipedia.org\/wiki\/Xvfb)\r\n\r\nSo I like to use screen to start a new session\r\n\r\n`screen -S running_xvfb`\r\n\r\nand then in there run\r\n\r\n`Xvfb :0 -screen 0 1280x8000x24 &`\r\n\r\nNow we want to swap back to our default session `CTRL+A` then still holding CTRL let go of A and press D.\r\n\r\nYou are back at your default terminal\r\n\r\nType:\r\n\r\n```\r\nvagrant@homestead:~\/Code\/webforms$ screen -ls\r\nThere is a screen on:\r\n\t16315.running_xvfb\t(04\/24\/2017 12:34:09 AM)\t(Detached)\r\n1 Socket in \/var\/run\/screen\/S-vagrant.\r\n```\r\n\r\nNow it all just worked!\r\n\r\n\r\n",
            "type": "post",
            "created_at": 1492994878,
            "updated_at": 1497011489,
            "score": 1.8702718
        },
        {
            "id": 159,
            "title": "Laravel 5.1 and Oauth",
            "body": "# Laravel 5.1 and Oauth2 Server\r\n\r\n\r\nVideo coming soon...\r\n\r\nExample repo is here [https:\/\/github.com\/alnutile\/oauth_how_to](https:\/\/github.com\/alnutile\/oauth_how_to)\r\n\r\nThe library we will use is \r\n\r\n[https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel)\r\n\r\nThis will setup a server both client_type and password_type for Grant Types.\r\n\r\n# Coming to Terms with Oauth\r\n\r\nComing to terms with this stuff is long and tedious.\r\nThe docs are here [https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel\/](https:\/\/github.com\/lucadegasperi\/oauth2-server-laravel\/) wiki will help and then these lead to the League docs as well [http:\/\/oauth2.thephpleague.com\/](http:\/\/oauth2.thephpleague.com\/) \r\n\r\nThere is also a podcast interview with the Alex Bilbie who made the League Oauth Library [http:\/\/fullstackradio.com\/episodes\/4\/](http:\/\/fullstackradio.com\/episodes\/4\/)\r\n\r\nWhat I will cover is mainly the instalation going beyond the docs above into the details of getting this thing going. I will also provide a \"play\" repo for you to review.\r\n\r\n## Base Laravel Install \r\n\r\nIf you want to use this demo to play around just run `composer install` and see the migration info below.\r\n\r\nInstall laravel as normal, install the library as normal. You will see some extra stuff I have in the repo for helping out as well (this will be seen in the video too)\r\n\r\n`app\/OauthTools`\r\n\r\nSome commands to use artisan to make users, tokens etc.\r\n\r\nSo in the end my `app\/Console\/Kernel.php` looked like [https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/Console\/Kernel.php](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/Console\/Kernel.php)\r\n\r\nSo I could easily do\r\n\r\n~~~\r\nphp artisan oauth-tools:adduser admin@foo.com\r\n~~~\r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/4oz4yn8p8gxftt2\/make_user_oauth.png?dl=0)\r\n\r\nor \r\n\r\n~~~\r\nphp artisan oauth-tools:generate-token 33591b34-03c2-4ece-a763-d531aee0298a admin@foo.com client\r\n~~~\r\n\r\nAlso note [composer.json](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/composer.json) I use a uuid library to help with these commands etc.\r\n\r\n\r\nFinally to have all of this work out of the box with the Postman file I shared run it this way for now\r\n\r\n~~~\r\ncd public\r\nphp -S localhost:8181\r\n~~~\r\n\r\nThe database for this example is sqlite so\r\n\r\n~~~\r\ntouch storage\/database.sqlite\r\nphp artisan migrate:refresh --seed\r\n~~~\r\n\r\nAnd you should now have a db and migrations\r\n\r\nSince it is sqlite just rm the file and touch it again to re-migrate and save your self the headache of DBAL driver etc since this just just a quick working demo.\r\n\r\n## Setup your oauth config\r\n\r\n`config\/oauth2.php` file as seen [here](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/config\/oauth2.php) **BUT** only if you want these. And my `access_token_ttl` is way too big so see the defaults in the docs. Also note it points to [OauthPasswordVerifier](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/app\/OauthPasswordVerifier.php) which the docs talk about as well.\r\n\r\n## Route\r\n\r\nAs noted you add the code to your route \r\n\r\n~~~\r\nRoute::post('oauth\/access_token', function() {\r\n    return Response::json(Authorizer::issueAccessToken());\r\n});\r\n\r\n\r\nRoute::get('test', ['middleware' => 'oauth', function() {\r\n    return Response::json(\"Welcome\");\r\n}]);\r\n~~~\r\n\r\nLater on you will see this instead\r\n\r\n~~~\r\nRoute::post('oauth\/access_token', function() {\r\n    return Response::json(Authorizer::issueAccessToken());\r\n});\r\n\r\n\r\nRoute::get('test', ['middleware' => 'oauthOrAuth', function() {\r\n    return Response::json(\"Welcome\");\r\n}]);\r\n~~~\r\n\r\nWith the **oauthOrAuth** I will explain that in the video as well. But basically and api endpoint can be used by a local session based user and a remote application using oauth. It is just how our APIs go.\r\n\r\nSo this lets that work just fine.\r\n\r\n## Postman \r\n\r\nJust to show it all working you will see in the video me using postman. You will see that in the repo [here](https:\/\/github.com\/alnutile\/oauth_how_to\/blob\/master\/oauth_try_2.json.postman_collection)\r\n\r\n\r\n## Now What\r\n\r\nBetween the links above and Postman you have a working \r\n\r\n![](https:\/\/dl.dropboxusercontent.com\/s\/bbt0fmfflm2zq7x\/oauth_token.gif?dl=0)\r\n\r\n\r\n",
            "type": "post",
            "created_at": 1439521108,
            "updated_at": 1439521242,
            "score": 1.8628951
        },
        {
            "id": 113,
            "title": "Laravel 4.2 and Dotenv to set environment",
            "body": "To start using Dotenv now it is very simple.\r\n\r\n# One include the library\r\n\r\n~~~\r\n#composer.js\r\n\t\"require\": {\r\n          \"laravel\/framework\": \"4.2.*\",\r\n          \"vlucas\/phpdotenv\": \"1.0.*@dev\"\r\n    },\r\n~~~\r\n\r\n# Two update your start.php\r\n\r\n~~~\r\n#bootstrap\/start.php line 27\r\nDotenv::load(__DIR__ .'\/..\/');\r\n\r\n\r\n$env = $app->detectEnvironment(\r\n    function()\r\n    {\r\n        return getenv('APP_ENV');\r\n    }\r\n);\r\n\r\n~~~\r\n\r\n# Make sure to set your .env file\r\n\r\n~~~\r\n#.env\r\nAPP_ENV='local'\r\n~~~\r\n\r\nThat is it you are set to use it for all your environments.\r\n\r\n\r\n**Update**\r\n\r\nFor Heroku I used this instead\r\n\r\n~~~\r\n$env = $app->detectEnvironment(\r\n    function()\r\n    {\r\n        if(!isset(getenv('APP_ENV')))\r\n        {\r\n            Dotenv::load(__DIR__ .'\/..\/');\r\n        }\r\n        return getenv('APP_ENV');\r\n    }\r\n);\r\n~~~\r\n\r\nSetting the initial APP_ENV using heroku config:set APP_ENV=stage\r\n",
            "type": "post",
            "created_at": 1415530865,
            "updated_at": 1426207406,
            "score": 1.8518908
        },
        {
            "id": 226,
            "title": "PostMark SMTP for sending Notifications and Password Resets",
            "body": "I have been using PostMark for years [https:\/\/postmarkapp.com](https:\/\/postmarkapp.com)\r\nfor sending emails, e.g. password reset and more.\r\n\r\nThey have an API but to get going with SMTP all the info is [here](https:\/\/postmarkapp.com\/developer\/user-guide\/sending-email\/sending-with-smtp)\r\n\r\nBasically get your KEY and use it in your .env like this:\r\n\r\n```\r\nMAIL_DRIVER=smtp\r\nMAIL_HOST=smtp.postmarkapp.com\r\nMAIL_PORT=587\r\nMAIL_USERNAME=foo\r\nMAIL_PASSWORD=foo\r\nMAIL_ENCRYPTION=tls\r\n```\r\n\r\nAnd all should work. Just make sure to \r\n\r\n  * Register the domain in their domain ui \r\n  * Set the from info in Laravel",
            "type": "post",
            "created_at": 1513218963,
            "updated_at": 1513218963,
            "score": 1.8518908
        },
        {
            "id": 112,
            "title": "Speeding up PHPunit tests and Behat in Laravel for Database refreshes",
            "body": "This [article](http:\/\/www.chrisduell.com\/blog\/development\/speeding-up-unit-tests-in-php\/) covers some good tips on this. Ideally you do not hit the database in unit tests but sometimes you do. Also in behat it hits the db all the time since it is at the Acceptance level.\r\n\r\n# Sqlite\r\n\r\nIt is a great database and works. We easily can use it on running tests. When seeding the db I have my main seeding class doing this\r\n\r\n~~~\r\n<?php\r\n\r\nuse Illuminate\\Database\\Seeder;\r\nuse Illuminate\\Database\\Eloquent\\Model;\r\nuse Illuminate\\Support\\Facades\\App;\r\nuse Illuminate\\Support\\Facades\\Config;\r\nuse Illuminate\\Support\\Facades\\DB;\r\n\r\nclass DatabaseSeeder extends Seeder {\r\n\r\n\t\/**\r\n\t * Run the database seeds.\r\n\t *\r\n\t * @return void\r\n\t *\/\r\n\tpublic function run()\r\n\t{\r\n\t\tModel::unguard();\r\n\r\n        if(App::environment() != 'testing') {\r\n            DB::statement('SET FOREIGN_KEY_CHECKS=0;');\r\n        }\r\n\r\n        $this->call('AppTableSeeder');\r\n        $this->call('ParentRequestExample');\r\n        $this->call('ProductionSeeder');\r\n        if(App::environment() != 'testing') {\r\n            DB::statement('SET FOREIGN_KEY_CHECKS=1;');\r\n        }\r\n\r\n\r\n\t}\r\n\r\n}\r\n\r\n~~~\r\n\r\nSince sqlite does not like this we skip it for it but not for production etc.\r\n\r\nSecond my config\/testing\/database.php looks like this (as noted in the article)\r\n\r\n~~~\r\n<?php\r\n\r\n\r\nreturn [\r\n    \r\n    'default' => 'sqlite',\r\n\r\n    'connections' => [\r\n\r\n        'mysql' => [\r\n            'driver'    => 'mysql',\r\n            'host'      => $_ENV['DB_URL'],\r\n            'database'  => $_ENV['DB_NAME'],\r\n            'username'  => $_ENV['MYSQL_USER'],\r\n            'password'  => $_ENV['MYSQL_PASSWORD'],\r\n\r\n            'charset'   => 'utf8',\r\n            'collation' => 'utf8_unicode_ci',\r\n            'prefix'    => '',\r\n        ],\r\n\r\n        'pgsql' => [\r\n            'driver'   => 'pgsql',\r\n            'host'     => 'localhost',\r\n            'database' => 'homestead',\r\n            'username' => 'homestead',\r\n            'password' => 'secret',\r\n            'charset'  => 'utf8',\r\n            'prefix'   => '',\r\n            'schema'   => 'public',\r\n        ],\r\n\r\n        'setup' => array(\r\n            'driver' => 'sqlite',\r\n            'database' => __DIR__.'\/..\/..\/database\/stubdb.sqlite',\r\n            'prefix' => '',\r\n        ),\r\n\r\n        'sqlite' => array(\r\n            'driver'   => 'sqlite',\r\n            'database' => __DIR__ . '\/..\/..\/database\/testing.sqlite',\r\n            'prefix'   => '',\r\n        ),\r\n\r\n    ],\r\n\r\n];\r\n~~~\r\n\r\nWhich makes the below seeding command to setup the stub db work\r\n\r\n~~~\r\nphp artisan migrate:refresh --seed --database=\"setup\" --env=\"testing\"\r\n~~~\r\n\r\n# PHPUnit\r\n\r\nWhat I ended up with is a base TestCase like this\r\n\r\n~~~\r\n\r\n    public function setUp()\r\n    {\r\n        parent::setUp();\r\n        $this->faker = Faker::create();\r\n        $this->prepareForTests();\r\n    }\r\n\r\n    private function prepareForTests()\r\n    {\r\n        if(!file_exists(base_path() . '\/app\/database\/testing.sqlite'))\r\n        {\r\n            $this->refreshDb();\r\n        }\r\n    }\r\n\r\n    public function refreshDb()\r\n\r\n    {\r\n        copy(base_path() . '\/app\/database\/stubdb.sqlite', base_path() . '\/app\/database\/testing.sqlite');\r\n    }\r\n\r\n~~~\r\n\r\nAnd with any new migrations I run this command\r\n\r\n~~~\r\nphp artisan migrate:refresh --seed --database=\"setup\" --env=\"testing\"\r\n~~~\r\n\r\nThat file is kept in git since it is just seed data. If there are any conflicts just rm and start over. Testing.sqlite is not kept in git.\r\n\r\n#Behat\r\n\r\nBehat is the same idea. In the main FeatureContext file I have\r\n\r\n~~~\r\n\r\n    \/**\r\n     * @Given \/^I reseed the database$\/\r\n     *\/\r\n    public function iReseedTheDatabase()\r\n    {\r\n        try\r\n        {\r\n            dd(getenv('APP_ENV'));\r\n            \/\/exec(\"php artisan migrate:refresh --seed\");\r\n            copy(__DIR__ . '\/..\/..\/..\/..\/database\/stubdb.sqlite', __DIR__ . '\/..\/..\/..\/..\/database\/testing.sqlite');\r\n        }\r\n        catch(\\Exception $e)\r\n        {\r\n            throw new \\Exception(sprintf(\"Error seeding the database %s\", $e->getMessage()));\r\n        }\r\n    }\r\n~~~\r\n\r\nSo as we test the ui or api we can reload the data.\r\n\r\n#Behat \/ Laravel\r\n\r\nThis package [https:\/\/github.com\/GuilhermeGuitte\/behat-laravel](https:\/\/github.com\/GuilhermeGuitte\/behat-laravel)\r\n\r\nThis integrates behat into artisan command line helping with environment settings for behat.",
            "type": "post",
            "created_at": 1415275094,
            "updated_at": 1415275267,
            "score": 1.8469967
        },
        {
            "id": 111,
            "title": "Angular Pusher Factory to Centralize Code (also using Laravel to set constants and properties)",
            "body": "This will cover\r\n\r\n  * Making an Angular factory to centralize Pusher setup in Angular\r\n  * Passing settings form Laravel to Angular (though could be just Angular and a .env file as well)\r\n  * Passing Constants into the Angular App to pass these settings around, in this case to the Pusher Factory.\r\n\r\n## Setup your constants\r\n\r\nThis is where I call in the info I need to use later on.\r\n\r\n~~~\r\n(function(){\r\n\r\n  function config($stateProvider, $urlRouterProvider) {\r\n      $urlRouterProvider.otherwise(\"\/dashboard\");\r\n      $stateProvider\r\n          .state('dashboard', {\r\n              url: \"\/dashboard\",\r\n              views: {\r\n                '': {\r\n                    controller: 'DashCtrl',\r\n                    controllerAs: 'vm',\r\n                    resolve: {\r\n                        reports: ['ReportsService', function(ReportsService)\r\n                        {\r\n                            return ReportsService.get();\r\n                        }]\r\n                    },\r\n                    templateUrl: \"\/assets\/js\/dashboard\/templates\/dashboard.html\"\r\n                };\r\n  }\r\n\r\n  function constants() {\r\n     return { 'pusher_public_key': window.pusher_public_key }\r\n  }\r\n\r\nangular\r\n    .module('app')\r\n    .config(config)\r\n    .constant('ENV', constants())\r\n    .run(function($rootScope, $state) {\r\n        $rootScope.$state = $state;\r\n    });\r\n})();\r\n~~~\r\n\r\nSo now we have the constants in place that are used by our factory below\r\n\r\n## The Pusher Factory \r\n\r\n~~~\r\n(function(){\r\n    'use strict';\r\n    function PusherService(ENV)\r\n    {\r\n        var vm = this;\r\n        vm.pusher = {};\r\n        vm.ENV = ENV; \/\/We set this up above on the constants area.\r\n        vm.channelSet = {};\r\n        vm.activate = activate;\r\n        vm._subscribeToChannel = _subscribeToChannel;\r\n        vm._channelBind = _channelBind;\r\n\r\n        vm.PusherService = {\r\n            setPusher: setPusher\r\n        };\r\n\r\n        vm.activate();\r\n\r\n        \/\/\/\/\r\n        function activate()\r\n        {\r\n            console.log(vm.ENV);\r\n            vm.pusher = new Pusher(vm.ENV.pusher_public_key);\r\n        }\r\n\r\n        function setPusher(channel, event, callback)\r\n        {\r\n            vm._subscribeToChannel(channel);\r\n            vm._channelBind(event, callback);\r\n        }\r\n\r\n        function _subscribeToChannel(channel)\r\n        {\r\n            vm.channelSet = vm.pusher.subscribe(channel);\r\n        }\r\n\r\n        function _channelBind(event_name, callback)\r\n        {\r\n            vm.channelSet.bind(event_name, callback);\r\n        }\r\n\r\n        return vm.PusherService;\r\n    }\r\n\r\n    angular.module('app')\r\n        .factory('PusherService', PusherService);\r\n})();\r\n~~~\r\n\r\n## Laravel now need to load the settings in the .env file so Angular can access them later. \r\n\r\nOf course this could purely be Angular.js loading them from a config file that is not in git but relative to a server, local dev area etc.\r\n\r\nI set this all up user [https:\/\/github.com\/laracasts\/PHP-Vars-To-Js-Transformer](https:\/\/github.com\/laracasts\/PHP-Vars-To-Js-Transformer)\r\n\r\nI run the config command *note the change*\r\n\r\n~~~\r\nphp artisan publish:config laracasts\/utilities\r\n~~~\r\n\r\nThen I edit that file\r\n\r\n~~~\r\nconfig\/packages\/laracasts\/utilities\/config.php\r\n~~~\r\n\r\nTo be\r\n\r\n~~~\r\n<?php\r\n\r\nreturn [\r\n\r\n    \/*\r\n    |--------------------------------------------------------------------------\r\n    | View to Bind JavaScript Vars To\r\n    |--------------------------------------------------------------------------\r\n    |\r\n    | Set this value to the name of the view (or partial) that\r\n    | you want to prepend the JavaScript variables to.\r\n    |\r\n    *\/\r\n    'bind_js_vars_to_this_view' => 'layouts\/main',\r\n\r\n    \/*\r\n    |--------------------------------------------------------------------------\r\n    | JavaScript Namespace\r\n    |--------------------------------------------------------------------------\r\n    |\r\n    | By default, we'll add variables to the global window object.\r\n    | It's recommended that you change this to some namespace - anything.\r\n    | That way, from your JS, you may do something like `Laracasts.myVar`.\r\n    |\r\n    *\/\r\n    'js_namespace' => 'window'\r\n\r\n];\r\n~~~\r\n\r\nThe resources\/views\/layouts\/main.blade.php the only trick here is any Angular related {{ brackets need to be @{{ to tell blade to ignore them.\r\n\r\nFinally my AngularController which renders the ONE page Laravel is in charge of besides login. \r\n\r\n~~~\r\n<?php namespace App\\Http\\Controllers;\r\n\r\nuse Laracasts\\Utilities\\JavaScript\\Facades\\JavaScript;\r\n\r\n\/**\r\n * @Middleware(\"auth\")\r\n *\/\r\nclass AngularController extends BaseController {\r\n\r\n\r\n    \/**\r\n     * @Get(\"dash\", as=\"dash\")\r\n     *\/\r\n\tpublic function index()\r\n\t{\r\n        JavaScript::put([\r\n            'pusher_public_key' => $_ENV['PUSHER_PUBLIC']]);\r\n\t\treturn view('layouts.main');\r\n\t}\r\n\r\n}\r\n~~~\r\n\r\nIf you have more than on View the share option might work [http:\/\/laravel.com\/docs\/master\/views](http:\/\/laravel.com\/docs\/master\/views)\r\n",
            "type": "post",
            "created_at": 1414114056,
            "updated_at": 1415541370,
            "score": 1.8119364
        }
    ]
}